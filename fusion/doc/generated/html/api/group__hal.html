<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTAI API: Hardware abstraction layer.</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>Hardware abstraction layer.</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Basic architecture-dependent services used by the real-time nucleus. 
<p>

<p>
<table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Files</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>file &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="hal_8c.html">hal.c</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adeos-based Real-Time Abstraction Layer for x86. <br><br></td></tr>

<p>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="anchor" name="a34" doxytag="hal::rthal_startup_irq" ></a>
int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a34">rthal_startup_irq</a> (unsigned irq)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">start and initialize the PIC to accept interrupt request irq. <br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a35">rthal_shutdown_irq</a> (unsigned irq)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Shut down an IRQ source. </em> <a href="#a35"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="anchor" name="a36" doxytag="hal::rthal_enable_irq" ></a>
int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a36">rthal_enable_irq</a> (unsigned irq)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enable an IRQ source. <br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="anchor" name="a37" doxytag="hal::rthal_disable_irq" ></a>
int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a37">rthal_disable_irq</a> (unsigned irq)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Disable an IRQ source. <br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a38">rthal_unmask_irq</a> (unsigned irq)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unmask and IRQ source. </em> <a href="#a38"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a39">rthal_request_linux_irq</a> (unsigned irq, irqreturn_t(*handler)(int irq, void *dev_id, struct pt_regs *regs), char *name, void *dev_id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Install a shared Linux interrupt handler. </em> <a href="#a39"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a40">rthal_free_linux_irq</a> (unsigned irq, void *dev_id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Uninstall shared Linux interrupt handler. </em> <a href="#a40"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a41">rthal_pend_linux_irq</a> (unsigned irq)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pend an IRQ to Linux. </em> <a href="#a41"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a42">rthal_request_srq</a> (unsigned label, void(*handler)(void))</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Install a system request handler. </em> <a href="#a42"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a43">rthal_free_srq</a> (unsigned srq)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Uninstall a system request handler. </em> <a href="#a43"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a44">rthal_pend_linux_srq</a> (unsigned srq)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Append a Linux IRQ. </em> <a href="#a44"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a51">rthal_request_timer</a> (void(*handler)(void), unsigned tick, int mod)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Install a timer interrupt handler. </em> <a href="#a51"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__hal.html#a52">rthal_free_timer</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Uninstall a timer interrupt handler. </em> <a href="#a52"></a><em><br><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a40" doxytag="hal.c::rthal_free_linux_irq" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int rthal_free_linux_irq </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned&nbsp;</td>
          <td class="mdname" nowrap> <em>irq</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>dev_id</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Uninstall shared Linux interrupt handler. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>dev_id</em>&nbsp;</td><td>is to pass to the interrupt handler, in the same way as the standard Linux irq request call.</td></tr>
    <tr><td valign=top><em>irq</em>&nbsp;</td><td>is the IRQ level of the interrupt handler to be freed.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign=top><em>-EINVAL</em>&nbsp;</td><td>if <em>irq</em> is not a valid external IRQ number. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="hal.c::rthal_free_srq" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int rthal_free_srq </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>srq</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Uninstall a system request handler. 
<p>
rthal_free_srq uninstalls the specified system call <em>srq</em>, returned by installing the related handler with a previous call to <a class="el" href="group__hal.html#a42">rthal_request_srq()</a>.<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>EINVAL</em>&nbsp;</td><td>if <em>srq</em> is invalid. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="hal.c::rthal_free_timer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void rthal_free_timer </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Uninstall a timer interrupt handler. 
<p>
rthal_free_timer uninstalls a timer previously set by <a class="el" href="group__hal.html#a51">rthal_request_timer()</a>.     </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="hal.c::rthal_pend_linux_irq" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int rthal_pend_linux_irq </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>irq</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Pend an IRQ to Linux. 
<p>
rthal_pend_linux_irq appends a Linux interrupt irq for processing in Linux IRQ mode, i.e. with hardware interrupts fully enabled.     </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="hal.c::rthal_pend_linux_srq" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int rthal_pend_linux_srq </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>srq</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Append a Linux IRQ. 
<p>
rthal_pend_linux_srq appends a system call request srq to be used as a service request to the Linux kernel.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>srq</em>&nbsp;</td><td>is the value returned by rthal_request_srq. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="hal.c::rthal_request_linux_irq" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int rthal_request_linux_irq </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned&nbsp;</td>
          <td class="mdname" nowrap> <em>irq</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>irqreturn_t(*&nbsp;</td>
          <td class="mdname" nowrap> <em>handler</em>)(int irq, void *dev_id, struct pt_regs *regs), </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>dev_id</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Install a shared Linux interrupt handler. 
<p>
rthal_request_linux_irq installs function <em>handler</em> as a standard Linux interrupt service routine for IRQ level <em>irq</em> forcing Linux to share the IRQ with other interrupt handlers. The handler is appended to any already existing Linux handler for the same irq and is run by Linux irq as any of its handler. In this way a real time application can monitor Linux interrupts handling at its will. The handler appears in /proc/interrupts.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>irq</em>&nbsp;</td><td>is the IRQ level to which the handler will be associated.</td></tr>
    <tr><td valign=top><em>handler</em>&nbsp;</td><td>pointer on the interrupt service routine to be installed.</td></tr>
    <tr><td valign=top><em>name</em>&nbsp;</td><td>is a name for /proc/interrupts.</td></tr>
    <tr><td valign=top><em>dev_id</em>&nbsp;</td><td>is to pass to the interrupt handler, in the same way as the standard Linux irq request call.</td></tr>
  </table>
</dl>
The interrupt service routine can be uninstalled using <a class="el" href="group__hal.html#a40">rthal_free_linux_irq()</a>.<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign=top><em>-EINVAL</em>&nbsp;</td><td>if <em>irq</em> is not a valid external IRQ number or handler is <code>NULL</code>. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="hal.c::rthal_request_srq" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int rthal_request_srq </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned&nbsp;</td>
          <td class="mdname" nowrap> <em>label</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void(*&nbsp;</td>
          <td class="mdname" nowrap> <em>handler</em>)(void)</td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Install a system request handler. 
<p>
rthal_request_srq installs a RTAI system request (srq) by assigning <em>handler</em>, the function to be called in kernel space following its activation by a call to <a class="el" href="group__hal.html#a44">rthal_pend_linux_srq()</a>. <em>handler</em> is in practice used to request a service from the kernel. In fact Linux system requests cannot be used safely from RTAI so you can setup a handler that receives real time requests and safely executes them when Linux is running.<p>
<dl compact><dt><b>Returns:</b></dt><dd>the number of the assigned system request on success. </dd></dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>-EINVAL</em>&nbsp;</td><td>if <em>handler</em> is <code>NULL</code>. </td></tr>
    <tr><td valign=top><em>-EBUSY</em>&nbsp;</td><td>if no free srq slot is available. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="hal.c::rthal_request_timer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int rthal_request_timer </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void(*&nbsp;</td>
          <td class="mdname" nowrap> <em>handler</em>)(void), </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>unsigned&nbsp;</td>
          <td class="mdname" nowrap> <em>tick</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mod</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Install a timer interrupt handler. 
<p>
rthal_request_timer requests a timer of period tick ticks, and installs the routine <em>handler</em> as a real time interrupt service routine for the timer.<p>
Set <em>tick</em> to 0 for oneshot mode (i.e. unused). <em>mod</em> is a platform-dependent bitmask affecting this service. For x86, the only applicable flag is RTHAL_USE_APIC, which forces the use of the local APIC timer when set. If this flag is unset, timing will be based on the 8254 PIT.     </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="hal.c::rthal_shutdown_irq" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int rthal_shutdown_irq </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>irq</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Shut down an IRQ source. 
<p>
No further interrupt request irq can be accepted.     </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="hal.c::rthal_unmask_irq" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int rthal_unmask_irq </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>irq</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Unmask and IRQ source. 
<p>
The related request can then interrupt the CPU again, provided it has also been acknowledged.     </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sun Jun 20 22:31:08 2004 for RTAI API by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
