<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTAI Fusion API: skins/rtdm/rtdm.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000018.html">skins</a>&nbsp;/&nbsp;<a class="el" href="dir_000020.html">rtdm</a></div>
<h1>rtdm.h</h1><a href="rtdm_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00035 <span class="preprocessor">#ifndef _RTDM_H</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define _RTDM_H</span>
00037 <span class="preprocessor"></span>
00038 <span class="preprocessor">#ifdef __KERNEL__</span>
00039 <span class="preprocessor"></span>
00040 <span class="preprocessor">#include &lt;linux/fcntl.h&gt;</span>
00041 <span class="preprocessor">#include &lt;linux/ioctl.h&gt;</span>
00042 <span class="preprocessor">#include &lt;linux/sched.h&gt;</span>
00043 <span class="preprocessor">#include &lt;linux/socket.h&gt;</span>
00044 
00045 <span class="keyword">typedef</span> size_t                      socklen_t;
00046 <span class="keyword">typedef</span> <span class="keyword">struct </span>task_struct          rtdm_user_info_t;
00047 
00048 <span class="preprocessor">#else  </span><span class="comment">/* !__KERNEL__ */</span>
00049 
00050 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00051 <span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span>
00052 <span class="preprocessor">#include &lt;sys/socket.h&gt;</span>
00053 
00054 <span class="preprocessor">#endif </span><span class="comment">/* !__KERNEL__ */</span>
00055 
00056 
<a name="l00058"></a><a class="code" href="rtdm_8h.html#a0">00058</a> <span class="preprocessor">#define RTDM_MAX_DEVNAME_LEN        31</span>
00059 <span class="preprocessor"></span>
00060 
00065 <span class="preprocessor">#define RTDM_CLASS_PARPORT          1</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_SERIAL           2</span>
00067 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_CAN              3</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_NETWORK          4</span>
00069 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_RTMAC            5</span>
00070 <span class="preprocessor"></span><span class="comment">/*</span>
00071 <span class="comment">#define RTDM_CLASS_USB              ?</span>
00072 <span class="comment">#define RTDM_CLASS_FIREWIRE         ?</span>
00073 <span class="comment">#define RTDM_CLASS_INTERBUS         ?</span>
00074 <span class="comment">#define RTDM_CLASS_PROFIBUS         ?</span>
00075 <span class="comment">#define ...</span>
00076 <span class="comment">*/</span>
00077 <span class="preprocessor">#define RTDM_CLASS_EXPERIMENTAL     224</span>
00078 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_MAX              255</span>
00079 <span class="preprocessor"></span>
00082 <span class="preprocessor">#define RTIOC_TYPE_COMMON           0</span>
00083 <span class="preprocessor"></span>
00084 
<a name="l00094"></a><a class="code" href="rtdm_8h.html#a9">00094</a> <span class="preprocessor">#define RTIOC_PURGE                 _IOW(RTIOC_TYPE_COMMON, 0x10, int)</span>
00095 <span class="preprocessor"></span>
00101 <span class="preprocessor">#define RTDM_PURGE_RX_BUFFER        0x0001</span>
00102 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_PURGE_TX_BUFFER        0x0002</span>
00103 <span class="preprocessor"></span>
00106 <span class="comment">/* Internally used for mapping socket functions on IOCTLs */</span>
00107 <span class="keyword">struct </span>_rtdm_getsockopt_args {
00108     <span class="keywordtype">int</span>                             level;
00109     <span class="keywordtype">int</span>                             optname;
00110     <span class="keywordtype">void</span>                            *optval;
00111     socklen_t                       *optlen;
00112 };
00113 
00114 <span class="keyword">struct </span>_rtdm_setsockopt_args {
00115     <span class="keywordtype">int</span>                             level;
00116     <span class="keywordtype">int</span>                             optname;
00117     <span class="keyword">const</span> <span class="keywordtype">void</span>                      *optval;
00118     socklen_t                       optlen;
00119 };
00120 
00121 <span class="keyword">struct </span>_rtdm_getsockaddr_args {
00122     <span class="keyword">struct </span>sockaddr                 *addr;
00123     socklen_t                       *addrlen;
00124 };
00125 
00126 <span class="keyword">struct </span>_rtdm_setsockaddr_args {
00127     <span class="keyword">const</span> <span class="keyword">struct </span>sockaddr           *addr;
00128     socklen_t                       addrlen;
00129 };
00130 
00131 <span class="preprocessor">#define _RTIOC_GETSOCKOPT          _IOW(RTIOC_TYPE_COMMON, 0x20,        \</span>
00132 <span class="preprocessor">                                        struct _rtdm_getsockopt_args)</span>
00133 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_SETSOCKOPT          _IOW(RTIOC_TYPE_COMMON, 0x21,        \</span>
00134 <span class="preprocessor">                                        struct _rtdm_setsockopt_args)</span>
00135 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_BIND                _IOW(RTIOC_TYPE_COMMON, 0x22,        \</span>
00136 <span class="preprocessor">                                        struct _rtdm_setsockaddr_args)</span>
00137 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_CONNECT             _IOW(RTIOC_TYPE_COMMON, 0x23,        \</span>
00138 <span class="preprocessor">                                        struct _rtdm_setsockaddr_args)</span>
00139 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_LISTEN              _IOW(RTIOC_TYPE_COMMON, 0x24,        \</span>
00140 <span class="preprocessor">                                        int)</span>
00141 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_ACCEPT              _IOW(RTIOC_TYPE_COMMON, 0x25,        \</span>
00142 <span class="preprocessor">                                        struct _rtdm_getsockaddr_args)</span>
00143 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_GETSOCKNAME         _IOW(RTIOC_TYPE_COMMON, 0x26,        \</span>
00144 <span class="preprocessor">                                        struct _rtdm_getsockaddr_args)</span>
00145 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_GETPEERNAME         _IOW(RTIOC_TYPE_COMMON, 0x27,        \</span>
00146 <span class="preprocessor">                                        struct _rtdm_getsockaddr_args)</span>
00147 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_SHUTDOWN            _IOW(RTIOC_TYPE_COMMON, 0x28,        \</span>
00148 <span class="preprocessor">                                        int)</span>
00149 <span class="preprocessor"></span>
00150 
00151 <span class="preprocessor">#ifdef __KERNEL__</span>
00152 <span class="preprocessor"></span><span class="keywordtype">int</span>     _rtdm_open   (rtdm_user_info_t *user_info, <span class="keyword">const</span> <span class="keywordtype">char</span> *path,
00153                       <span class="keywordtype">int</span> oflag);
00154 <span class="keywordtype">int</span>     _rtdm_socket (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> protocol_family,
00155                       <span class="keywordtype">int</span> socket_type, <span class="keywordtype">int</span> protocol);
00156 <span class="keywordtype">int</span>     _rtdm_close  (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> forced);
00157 <span class="keywordtype">int</span>     _rtdm_ioctl  (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> request, ...);
00158 ssize_t _rtdm_read   (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf,
00159                       size_t nbyte);
00160 ssize_t _rtdm_write  (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf,
00161                       size_t nbyte);
00162 ssize_t _rtdm_recvmsg(rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keyword">struct</span> msghdr *msg,
00163                       <span class="keywordtype">int</span> flags);
00164 ssize_t _rtdm_sendmsg(rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd,
00165                       <span class="keyword">const</span> <span class="keyword">struct</span> msghdr *msg, <span class="keywordtype">int</span> flags);
00166 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00167 
00168 
00169 <span class="comment">/* Define RTDM_NO_DEFAULT_USER_API to switch off the default rt_dev_xxx</span>
00170 <span class="comment"> * interface when providing a customised user API */</span>
00171 <span class="preprocessor">#ifndef RTDM_NO_DEFAULT_USER_API</span>
00172 <span class="preprocessor"></span>
00173 <span class="preprocessor">#ifdef __KERNEL__</span>
00174 <span class="preprocessor"></span>
00175 <span class="preprocessor">#define rt_dev_open(path, oflag, ...)                           \</span>
00176 <span class="preprocessor">    _rtdm_open(NULL, path, oflag)</span>
00177 <span class="preprocessor"></span>
00178 <span class="preprocessor">#define rt_dev_socket(protocol_family, socket_type, protocol)   \</span>
00179 <span class="preprocessor">    _rtdm_socket(NULL, protocol_family, socket_type, protocol)</span>
00180 <span class="preprocessor"></span>
00181 <span class="preprocessor">#define rt_dev_close(fd)                                        \</span>
00182 <span class="preprocessor">    _rtdm_close(NULL, fd, 0)</span>
00183 <span class="preprocessor"></span>
00184 <span class="preprocessor">#define rt_dev_ioctl(fd, request, ...)                          \</span>
00185 <span class="preprocessor">    _rtdm_ioctl(NULL, fd, request, __VA_ARGS__)</span>
00186 <span class="preprocessor"></span>
00187 <span class="preprocessor">#define rt_dev_read(fd, buf, nbyte)                             \</span>
00188 <span class="preprocessor">    _rtdm_read(NULL, fd, buf, nbyte)</span>
00189 <span class="preprocessor"></span>
00190 <span class="preprocessor">#define rt_dev_write(fd, buf, nbyte)                            \</span>
00191 <span class="preprocessor">    _rtdm_write(NULL, fd, buf, nbyte)</span>
00192 <span class="preprocessor"></span>
00193 <span class="preprocessor">#define rt_dev_recvmsg(fd, msg, flags)                          \</span>
00194 <span class="preprocessor">    _rtdm_recvmsg(NULL, fd, msg, flags)</span>
00195 <span class="preprocessor"></span>
00196 <span class="preprocessor">#define rt_dev_sendmsg(fd, msg, flags)                          \</span>
00197 <span class="preprocessor">    _rtdm_sendmsg(NULL, fd, msg, flags)</span>
00198 <span class="preprocessor"></span>
00199 
00200 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t <a class="code" href="group__userapi.html#ga7">rt_dev_recvfrom</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t len, <span class="keywordtype">int</span> flags,
00201                                       <span class="keyword">struct</span> sockaddr *from,
00202                                       socklen_t *fromlen)
00203 {
00204     <span class="keyword">struct </span>iovec    iov = {buf, len};
00205     <span class="keyword">struct </span>msghdr   msg =
00206         {from, (from != NULL) ? *fromlen : 0, &amp;iov, 1, NULL, 0};
00207     <span class="keywordtype">int</span>             ret;
00208 
00209     ret = <a class="code" href="group__userapi.html#ga6">rt_dev_recvmsg</a>(fd, &amp;msg, flags);
00210     <span class="keywordflow">if</span> ((ret &gt;= 0) &amp;&amp; (from != NULL))
00211         *fromlen = msg.msg_namelen;
00212     <span class="keywordflow">return</span> ret;
00213 }
00214 
00215 <span class="preprocessor">#else  </span><span class="comment">/* !__KERNEL__ */</span>
00216 
00217 <span class="keywordtype">int</span>     <a class="code" href="group__userapi.html#ga0">rt_dev_open</a>   (<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> oflag, ...);
00218 <span class="keywordtype">int</span>     <a class="code" href="group__userapi.html#ga1">rt_dev_socket</a> (<span class="keywordtype">int</span> protocol_family, <span class="keywordtype">int</span> socket_type, <span class="keywordtype">int</span> protocol);
00219 <span class="keywordtype">int</span>     <a class="code" href="group__userapi.html#ga2">rt_dev_close</a>  (<span class="keywordtype">int</span> fd);
00220 <span class="keywordtype">int</span>     <a class="code" href="group__userapi.html#ga3">rt_dev_ioctl</a>  (<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> request, ...);
00221 ssize_t <a class="code" href="group__userapi.html#ga4">rt_dev_read</a>   (<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t nbyte);
00222 ssize_t <a class="code" href="group__userapi.html#ga5">rt_dev_write</a>  (<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, size_t nbyte);
00223 ssize_t <a class="code" href="group__userapi.html#ga6">rt_dev_recvmsg</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> msghdr *msg, <span class="keywordtype">int</span> flags);
00224 ssize_t <a class="code" href="group__userapi.html#ga9">rt_dev_sendmsg</a>(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keyword">struct</span> msghdr *msg, <span class="keywordtype">int</span> flags);
00225 
00226 ssize_t <a class="code" href="group__userapi.html#ga7">rt_dev_recvfrom</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t len, <span class="keywordtype">int</span> flags,
00227                         <span class="keyword">struct</span> sockaddr *from,
00228                         socklen_t *fromlen);
00229 
00230 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00231 
00232 
00233 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t <a class="code" href="group__userapi.html#ga8">rt_dev_recv</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t len, <span class="keywordtype">int</span> flags)
00234 {
00235     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga7">rt_dev_recvfrom</a>(fd, buf, len, flags, NULL, NULL);
00236 }
00237 
00238 
00239 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t <a class="code" href="group__userapi.html#ga10">rt_dev_sendto</a>(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, size_t len,
00240                                     <span class="keywordtype">int</span> flags, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *to,
00241                                     socklen_t tolen)
00242 {
00243     <span class="keyword">struct </span>iovec    iov = {(<span class="keywordtype">void</span> *)buf, len};
00244     <span class="keyword">struct </span>msghdr   msg =
00245         {(<span class="keyword">struct </span>sockaddr *)to, tolen, &amp;iov, 1, NULL, 0};
00246 
00247     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga9">rt_dev_sendmsg</a>(fd, &amp;msg, flags);
00248 }
00249 
00250 
00251 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t <a class="code" href="group__userapi.html#ga11">rt_dev_send</a>(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, size_t len,
00252                                   <span class="keywordtype">int</span> flags)
00253 {
00254     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga10">rt_dev_sendto</a>(fd, buf, len, flags, NULL, 0);
00255 }
00256 
00257 
00258 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__userapi.html#ga17">rt_dev_getsockopt</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> optname,
00259                                     <span class="keywordtype">void</span> *optval, socklen_t *optlen)
00260 {
00261     <span class="keyword">struct </span>_rtdm_getsockopt_args args = {level, optname, optval, optlen};
00262 
00263     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga3">rt_dev_ioctl</a>(fd, _RTIOC_GETSOCKOPT, &amp;args);
00264 }
00265 
00266 
00267 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__userapi.html#ga18">rt_dev_setsockopt</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> optname,
00268                                     <span class="keyword">const</span> <span class="keywordtype">void</span> *optval, socklen_t optlen)
00269 {
00270     <span class="keyword">struct </span>_rtdm_setsockopt_args args =
00271     {level, optname, (<span class="keywordtype">void</span> *)optval, optlen};
00272 
00273     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga3">rt_dev_ioctl</a>(fd, _RTIOC_SETSOCKOPT, &amp;args);
00274 }
00275 
00276 
00277 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__userapi.html#ga12">rt_dev_bind</a>(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *my_addr,
00278                               socklen_t addrlen)
00279 {
00280     <span class="keyword">struct </span>_rtdm_setsockaddr_args args = {my_addr, addrlen};
00281 
00282     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga3">rt_dev_ioctl</a>(fd, _RTIOC_BIND, &amp;args);
00283 }
00284 
00285 
00286 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__userapi.html#ga13">rt_dev_connect</a>(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *serv_addr,
00287                                  socklen_t addrlen)
00288 {
00289     <span class="keyword">struct </span>_rtdm_setsockaddr_args args = {serv_addr, addrlen};
00290 
00291     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga3">rt_dev_ioctl</a>(fd, _RTIOC_CONNECT, &amp;args);
00292 }
00293 
00294 
00295 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__userapi.html#ga14">rt_dev_listen</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> backlog)
00296 {
00297     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga3">rt_dev_ioctl</a>(fd, _RTIOC_LISTEN, backlog);
00298 }
00299 
00300 
00301 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__userapi.html#ga15">rt_dev_accept</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> sockaddr *addr,
00302                                 socklen_t *addrlen)
00303 {
00304     <span class="keyword">struct </span>_rtdm_getsockaddr_args args = {addr, addrlen};
00305 
00306     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga3">rt_dev_ioctl</a>(fd, _RTIOC_ACCEPT, &amp;args);
00307 }
00308 
00309 
00310 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__userapi.html#ga19">rt_dev_getsockname</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> sockaddr *name,
00311                                      socklen_t *namelen)
00312 {
00313     <span class="keyword">struct </span>_rtdm_getsockaddr_args args = {name, namelen};
00314 
00315     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga3">rt_dev_ioctl</a>(fd, _RTIOC_GETSOCKNAME, &amp;args);
00316 }
00317 
00318 
00319 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__userapi.html#ga20">rt_dev_getpeername</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> sockaddr *name,
00320                                      socklen_t *namelen)
00321 {
00322     <span class="keyword">struct </span>_rtdm_getsockaddr_args args = {name, namelen};
00323 
00324     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga3">rt_dev_ioctl</a>(fd, _RTIOC_GETPEERNAME, &amp;args);
00325 }
00326 
00327 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__userapi.html#ga16">rt_dev_shutdown</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> how)
00328 {
00329     <span class="keywordflow">return</span> <a class="code" href="group__userapi.html#ga3">rt_dev_ioctl</a>(fd, _RTIOC_SHUTDOWN, how);
00330 }
00331 
00332 <span class="preprocessor">#endif </span><span class="comment">/* RTDM_NO_DEFAULT_USER_API */</span>
00333 
00334 <span class="preprocessor">#endif </span><span class="comment">/* _RTDM_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Aug 1 07:27:26 2005 for RTAI Fusion API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
