<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTAI Fusion API: skins/rtdm/rtdm_driver.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000018.html">skins</a>&nbsp;/&nbsp;<a class="el" href="dir_000020.html">rtdm</a></div>
<h1>rtdm_driver.h</h1><a href="rtdm__driver_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00025 <span class="preprocessor">#ifndef _RTDM_DRIVER_H</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#define _RTDM_DRIVER_H</span>
00027 <span class="preprocessor"></span>
00028 <span class="preprocessor">#ifndef __KERNEL__</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#error This header is for kernel space usage only. \</span>
00030 <span class="preprocessor">       You are likely looking for rtdm/rtdm.h...</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* !__KERNEL__ */</span>
00032 
00033 <span class="preprocessor">#include &lt;asm/atomic.h&gt;</span>
00034 <span class="preprocessor">#include &lt;linux/list.h&gt;</span>
00035 
00036 <span class="preprocessor">#include &lt;nucleus/fusion.h&gt;</span>
00037 <span class="preprocessor">#include &lt;nucleus/heap.h&gt;</span>
00038 <span class="preprocessor">#include &lt;<a class="code" href="pod_8h.html">nucleus/pod.h</a>&gt;</span>
00039 <span class="preprocessor">#include &lt;nucleus/synch.h&gt;</span>
00040 <span class="preprocessor">#include &lt;<a class="code" href="rtdm_8h.html">rtdm/rtdm.h</a>&gt;</span>
00041 
00042 
00043 <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>;
00044 
00045 
<a name="l00054"></a><a class="code" href="rtdm__driver_8h.html#a0">00054</a> <span class="preprocessor">#define RTDM_EXCLUSIVE              0x0001</span>
00055 <span class="preprocessor"></span>
<a name="l00057"></a><a class="code" href="rtdm__driver_8h.html#a1">00057</a> <span class="preprocessor">#define RTDM_NAMED_DEVICE           0x0010</span>
00058 <span class="preprocessor"></span>
<a name="l00061"></a><a class="code" href="rtdm__driver_8h.html#a2">00061</a> <span class="preprocessor">#define RTDM_PROTOCOL_DEVICE        0x0020</span>
00062 <span class="preprocessor"></span>
<a name="l00064"></a><a class="code" href="rtdm__driver_8h.html#a3">00064</a> <span class="preprocessor">#define RTDM_DEVICE_TYPE_MASK       0x00F0</span>
00065 <span class="preprocessor"></span>
<a name="l00075"></a><a class="code" href="rtdm__driver_8h.html#a4">00075</a> <span class="preprocessor">#define RTDM_CREATED_IN_NRT         0</span>
00076 <span class="preprocessor"></span>
<a name="l00078"></a><a class="code" href="rtdm__driver_8h.html#a5">00078</a> <span class="preprocessor">#define RTDM_CLOSING                1</span>
00079 <span class="preprocessor"></span>
<a name="l00082"></a><a class="code" href="rtdm__driver_8h.html#a6">00082</a> <span class="preprocessor">#define RTDM_FORCED_CLOSING         2</span>
00083 <span class="preprocessor"></span>
<a name="l00085"></a><a class="code" href="rtdm__driver_8h.html#a7">00085</a> <span class="preprocessor">#define RTDM_USER_CONTEXT_FLAG      8   </span><span class="comment">/* first user-definable flag */</span>
00086 
<a name="l00097"></a><a class="code" href="rtdm__driver_8h.html#a8">00097</a> <span class="preprocessor">#define RTDM_DEVICE_STRUCT_VER      3</span>
00098 <span class="preprocessor"></span>
<a name="l00100"></a><a class="code" href="rtdm__driver_8h.html#a9">00100</a> <span class="preprocessor">#define RTDM_CONTEXT_STRUCT_VER     3</span>
00101 <span class="preprocessor"></span>
<a name="l00103"></a><a class="code" href="rtdm__driver_8h.html#a10">00103</a> <span class="preprocessor">#define RTDM_API_VER                3</span>
00104 <span class="preprocessor"></span>
<a name="l00106"></a><a class="code" href="rtdm__driver_8h.html#a11">00106</a> <span class="preprocessor">#define RTDM_API_MIN_COMPAT_VER     3</span>
00107 <span class="preprocessor"></span>
<a name="l00109"></a><a class="code" href="rtdm__driver_8h.html#a12">00109</a> <span class="preprocessor">#define RTDM_SECURE_DEVICE          0x80000000</span>
00110 <span class="preprocessor"></span>
<a name="l00112"></a><a class="code" href="rtdm__driver_8h.html#a13">00112</a> <span class="preprocessor">#define RTDM_DRIVER_VER(major, minor, patch) \</span>
00113 <span class="preprocessor">    (((major &amp; 0xFF) &lt;&lt; 16) | ((minor &amp; 0xFF) &lt;&lt; 8) | (patch &amp; 0xFF))</span>
00114 <span class="preprocessor"></span>
<a name="l00116"></a><a class="code" href="rtdm__driver_8h.html#a14">00116</a> <span class="preprocessor">#define RTDM_DRIVER_MAJOR_VER(ver)  (((ver) &gt;&gt; 16) &amp; 0xFF)</span>
00117 <span class="preprocessor"></span>
<a name="l00119"></a><a class="code" href="rtdm__driver_8h.html#a15">00119</a> <span class="preprocessor">#define RTDM_DRIVER_MINOR_VER(ver)  (((ver) &gt;&gt; 8) &amp; 0xFF)</span>
00120 <span class="preprocessor"></span>
<a name="l00122"></a><a class="code" href="rtdm__driver_8h.html#a16">00122</a> <span class="preprocessor">#define RTDM_DRIVER_PATCH_VER(ver) ((ver) &amp; 0xFF)</span>
00123 <span class="preprocessor"></span>
00144 <span class="keyword">typedef</span>
<a name="l00145"></a><a class="code" href="rtdm__driver_8h.html#a52">00145</a>     int     (*<a class="code" href="rtdm__driver_8h.html#a52">rtdm_open_handler_t</a>)   (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00146                                       rtdm_user_info_t          *user_info,
00147                                       <span class="keywordtype">int</span>                       oflag);
00148 
00161 <span class="keyword">typedef</span>
<a name="l00162"></a><a class="code" href="rtdm__driver_8h.html#a53">00162</a>     int     (*<a class="code" href="rtdm__driver_8h.html#a53">rtdm_socket_handler_t</a>) (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00163                                       rtdm_user_info_t          *user_info,
00164                                       <span class="keywordtype">int</span>                       protocol);
00165 
00177 <span class="keyword">typedef</span>
<a name="l00178"></a><a class="code" href="rtdm__driver_8h.html#a54">00178</a>     int     (*<a class="code" href="rtdm__driver_8h.html#a54">rtdm_close_handler_t</a>)  (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00179                                       rtdm_user_info_t          *user_info);
00180 
00194 <span class="keyword">typedef</span>
<a name="l00195"></a><a class="code" href="rtdm__driver_8h.html#a55">00195</a>     int     (*<a class="code" href="rtdm__driver_8h.html#a55">rtdm_ioctl_handler_t</a>)  (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00196                                       rtdm_user_info_t          *user_info,
00197                                       <span class="keywordtype">int</span>                       request,
00198                                       <span class="keywordtype">void</span>                      *arg);
00199 
00213 <span class="keyword">typedef</span>
<a name="l00214"></a><a class="code" href="rtdm__driver_8h.html#a56">00214</a>     ssize_t (*<a class="code" href="rtdm__driver_8h.html#a56">rtdm_read_handler_t</a>)   (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00215                                       rtdm_user_info_t          *user_info,
00216                                       <span class="keywordtype">void</span>                      *buf,
00217                                       size_t                    nbyte);
00218 
00233 <span class="keyword">typedef</span>
<a name="l00234"></a><a class="code" href="rtdm__driver_8h.html#a57">00234</a>     ssize_t (*<a class="code" href="rtdm__driver_8h.html#a57">rtdm_write_handler_t</a>)  (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00235                                       rtdm_user_info_t          *user_info,
00236                                       <span class="keyword">const</span> <span class="keywordtype">void</span>                *buf,
00237                                       size_t                    nbyte);
00238 
00254 <span class="keyword">typedef</span>
<a name="l00255"></a><a class="code" href="rtdm__driver_8h.html#a58">00255</a>     ssize_t (*<a class="code" href="rtdm__driver_8h.html#a58">rtdm_recvmsg_handler_t</a>)(<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00256                                       rtdm_user_info_t          *user_info,
00257                                       <span class="keyword">struct </span>msghdr             *msg,
00258                                       <span class="keywordtype">int</span>                       flags);
00259 
00275 <span class="keyword">typedef</span>
<a name="l00276"></a><a class="code" href="rtdm__driver_8h.html#a59">00276</a>     ssize_t (*<a class="code" href="rtdm__driver_8h.html#a59">rtdm_sendmsg_handler_t</a>)(<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00277                                       rtdm_user_info_t          *user_info,
00278                                       <span class="keyword">const</span> <span class="keyword">struct </span>msghdr       *msg,
00279                                       <span class="keywordtype">int</span>                       flags);
00282 <span class="keyword">typedef</span>
00283     int     (*rtdm_rt_handler_t)     (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00284                                       rtdm_user_info_t          *user_info,
00285                                       <span class="keywordtype">void</span>                      *arg);
00286 
00287 
<a name="l00292"></a><a class="code" href="structrtdm__operations.html">00292</a> <span class="keyword">struct </span><a class="code" href="structrtdm__operations.html">rtdm_operations</a> {
<a name="l00297"></a><a class="code" href="structrtdm__operations.html#z30_0">00297</a>     <a class="code" href="rtdm__driver_8h.html#a54">rtdm_close_handler_t</a>            <a class="code" href="structrtdm__operations.html#z30_0">close_rt</a>;
<a name="l00300"></a><a class="code" href="structrtdm__operations.html#z30_1">00300</a>     <a class="code" href="rtdm__driver_8h.html#a54">rtdm_close_handler_t</a>            <a class="code" href="structrtdm__operations.html#z30_1">close_nrt</a>;
<a name="l00302"></a><a class="code" href="structrtdm__operations.html#z30_2">00302</a>     <a class="code" href="rtdm__driver_8h.html#a55">rtdm_ioctl_handler_t</a>            <a class="code" href="structrtdm__operations.html#z30_2">ioctl_rt</a>;
<a name="l00304"></a><a class="code" href="structrtdm__operations.html#z30_3">00304</a>     <a class="code" href="rtdm__driver_8h.html#a55">rtdm_ioctl_handler_t</a>            <a class="code" href="structrtdm__operations.html#z30_3">ioctl_nrt</a>;
<a name="l00310"></a><a class="code" href="structrtdm__operations.html#z31_0">00310</a>     <a class="code" href="rtdm__driver_8h.html#a56">rtdm_read_handler_t</a>             <a class="code" href="structrtdm__operations.html#z31_0">read_rt</a>;
<a name="l00312"></a><a class="code" href="structrtdm__operations.html#z31_1">00312</a>     <a class="code" href="rtdm__driver_8h.html#a56">rtdm_read_handler_t</a>             <a class="code" href="structrtdm__operations.html#z31_1">read_nrt</a>;
<a name="l00314"></a><a class="code" href="structrtdm__operations.html#z31_2">00314</a>     <a class="code" href="rtdm__driver_8h.html#a57">rtdm_write_handler_t</a>            <a class="code" href="structrtdm__operations.html#z31_2">write_rt</a>;
<a name="l00316"></a><a class="code" href="structrtdm__operations.html#z31_3">00316</a>     <a class="code" href="rtdm__driver_8h.html#a57">rtdm_write_handler_t</a>            <a class="code" href="structrtdm__operations.html#z31_3">write_nrt</a>;
<a name="l00322"></a><a class="code" href="structrtdm__operations.html#z32_0">00322</a>     <a class="code" href="rtdm__driver_8h.html#a58">rtdm_recvmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z32_0">recvmsg_rt</a>;
<a name="l00324"></a><a class="code" href="structrtdm__operations.html#z32_1">00324</a>     <a class="code" href="rtdm__driver_8h.html#a58">rtdm_recvmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z32_1">recvmsg_nrt</a>;
<a name="l00326"></a><a class="code" href="structrtdm__operations.html#z32_2">00326</a>     <a class="code" href="rtdm__driver_8h.html#a59">rtdm_sendmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z32_2">sendmsg_rt</a>;
<a name="l00328"></a><a class="code" href="structrtdm__operations.html#z32_3">00328</a>     <a class="code" href="rtdm__driver_8h.html#a59">rtdm_sendmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z32_3">sendmsg_nrt</a>;
00330 };
00331 
<a name="l00343"></a><a class="code" href="structrtdm__dev__context.html">00343</a> <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> {
<a name="l00345"></a><a class="code" href="structrtdm__dev__context.html#o0">00345</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   <a class="code" href="structrtdm__dev__context.html#o0">context_flags</a>;
<a name="l00347"></a><a class="code" href="structrtdm__dev__context.html#o1">00347</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__dev__context.html#o1">fd</a>;
<a name="l00350"></a><a class="code" href="structrtdm__dev__context.html#o2">00350</a>     atomic_t                        <a class="code" href="structrtdm__dev__context.html#o2">close_lock_count</a>;
<a name="l00352"></a><a class="code" href="structrtdm__dev__context.html#o3">00352</a>     <span class="keyword">struct </span><a class="code" href="structrtdm__operations.html">rtdm_operations</a>          *<a class="code" href="structrtdm__dev__context.html#o3">ops</a>;
<a name="l00354"></a><a class="code" href="structrtdm__dev__context.html#o4">00354</a>     <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structrtdm__device.html">rtdm_device</a>     *<a class="code" href="structrtdm__dev__context.html#o4">device</a>;
<a name="l00356"></a><a class="code" href="structrtdm__dev__context.html#o5">00356</a>     <span class="keywordtype">char</span>                            <a class="code" href="structrtdm__dev__context.html#o5">dev_private</a>[0];
00357 };
00358 
00359 <span class="keyword">struct </span>rtdm_dev_reserved {
00360     <span class="keyword">struct </span>list_head                entry;
00361     atomic_t                        refcount;
00362     <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>         *exclusive_context;
00363 };
00364 
<a name="l00373"></a><a class="code" href="structrtdm__device.html">00373</a> <span class="keyword">struct </span><a class="code" href="structrtdm__device.html">rtdm_device</a> {
<a name="l00376"></a><a class="code" href="structrtdm__device.html#o0">00376</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o0">struct_version</a>;
00377 
<a name="l00379"></a><a class="code" href="structrtdm__device.html#o1">00379</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o1">device_flags</a>;
<a name="l00381"></a><a class="code" href="structrtdm__device.html#o2">00381</a>     size_t                          <a class="code" href="structrtdm__device.html#o2">context_size</a>;
00382 
<a name="l00384"></a><a class="code" href="structrtdm__device.html#o3">00384</a>     <span class="keywordtype">char</span>                            <a class="code" href="structrtdm__device.html#o3">device_name</a>[<a class="code" href="rtdm_8h.html#a0">RTDM_MAX_DEVNAME_LEN</a>+1];
00385 
<a name="l00387"></a><a class="code" href="structrtdm__device.html#o4">00387</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o4">protocol_family</a>;
<a name="l00389"></a><a class="code" href="structrtdm__device.html#o5">00389</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o5">socket_type</a>;
00390 
<a name="l00393"></a><a class="code" href="structrtdm__device.html#o6">00393</a>     <a class="code" href="rtdm__driver_8h.html#a52">rtdm_open_handler_t</a>             <a class="code" href="structrtdm__device.html#o6">open_rt</a>;
<a name="l00396"></a><a class="code" href="structrtdm__device.html#o7">00396</a>     <a class="code" href="rtdm__driver_8h.html#a52">rtdm_open_handler_t</a>             <a class="code" href="structrtdm__device.html#o7">open_nrt</a>;
00397 
<a name="l00400"></a><a class="code" href="structrtdm__device.html#o8">00400</a>     <a class="code" href="rtdm__driver_8h.html#a53">rtdm_socket_handler_t</a>           <a class="code" href="structrtdm__device.html#o8">socket_rt</a>;
<a name="l00403"></a><a class="code" href="structrtdm__device.html#o9">00403</a>     <a class="code" href="rtdm__driver_8h.html#a53">rtdm_socket_handler_t</a>           <a class="code" href="structrtdm__device.html#o9">socket_nrt</a>;
00404 
<a name="l00406"></a><a class="code" href="structrtdm__device.html#o10">00406</a>     <span class="keyword">struct </span><a class="code" href="structrtdm__operations.html">rtdm_operations</a>          ops;
00407 
<a name="l00409"></a><a class="code" href="structrtdm__device.html#o11">00409</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o11">device_class</a>;
<a name="l00412"></a><a class="code" href="structrtdm__device.html#o12">00412</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o12">device_sub_class</a>;
<a name="l00414"></a><a class="code" href="structrtdm__device.html#o13">00414</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o13">driver_name</a>;
<a name="l00416"></a><a class="code" href="structrtdm__device.html#o14">00416</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o14">driver_version</a>;
<a name="l00419"></a><a class="code" href="structrtdm__device.html#o15">00419</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o15">peripheral_name</a>;
<a name="l00421"></a><a class="code" href="structrtdm__device.html#o16">00421</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o16">provider_name</a>;
00422 
<a name="l00424"></a><a class="code" href="structrtdm__device.html#o17">00424</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o17">proc_name</a>;
<a name="l00426"></a><a class="code" href="structrtdm__device.html#o18">00426</a>     <span class="keyword">struct </span>proc_dir_entry           *<a class="code" href="structrtdm__device.html#o18">proc_entry</a>;
00427 
<a name="l00429"></a><a class="code" href="structrtdm__device.html#o19">00429</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o19">device_id</a>;
00430 
<a name="l00432"></a><a class="code" href="structrtdm__device.html#o20">00432</a>     <span class="keyword">struct </span>rtdm_dev_reserved        reserved;
00433 };
00434 
00435 
00436 <span class="comment">/* --- device registration --- */</span>
00437 
00438 <span class="keywordtype">int</span> <a class="code" href="group__devregister.html#ga0">rtdm_dev_register</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__device.html">rtdm_device</a>* device);
00439 <span class="keywordtype">int</span> <a class="code" href="group__devregister.html#ga1">rtdm_dev_unregister</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__device.html">rtdm_device</a>* device, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poll_delay);
00440 
00441 
00442 <span class="comment">/* --- inter-driver API --- */</span>
00443 
00444 <span class="preprocessor">#define rtdm_open                   rt_dev_open</span>
00445 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_socket                 rt_dev_socket</span>
00446 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_close                  rt_dev_close</span>
00447 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_ioctl                  rt_dev_ioctl</span>
00448 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_read                   rt_dev_read</span>
00449 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_write                  rt_dev_write</span>
00450 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_rescmsg                rt_dev_recvmsg</span>
00451 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_recv                   rt_dev_recv</span>
00452 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_recvfrom               rt_dev_recvfrom</span>
00453 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_sendmsg                rt_dev_sendmsg</span>
00454 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_send                   rt_dev_send</span>
00455 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_sendto                 rt_dev_sendto</span>
00456 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_bind                   rt_dev_bind</span>
00457 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_listen                 rt_dev_listen</span>
00458 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_accept                 rt_dev_accept</span>
00459 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_getsockopt             rt_dev_getsockopt</span>
00460 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_setsockopt             rt_dev_setsockopt</span>
00461 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_getsockname            rt_dev_getsockname</span>
00462 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_getpeername            rt_dev_getpeername</span>
00463 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_shutdown               rt_dev_shutdown</span>
00464 <span class="preprocessor"></span>
00465 <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *<a class="code" href="group__interdrv.html#ga7">rtdm_context_get</a>(<span class="keywordtype">int</span> <a class="code" href="structrtdm__dev__context.html#o1">fd</a>);
00466 
00467 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__interdrv.html#ga19">rtdm_context_lock</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *context)
00468 {
00469     atomic_inc(&amp;context-&gt;<a class="code" href="structrtdm__dev__context.html#o2">close_lock_count</a>);
00470 }
00471 
00472 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__interdrv.html#ga20">rtdm_context_unlock</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *context)
00473 {
00474     atomic_dec(&amp;context-&gt;<a class="code" href="structrtdm__dev__context.html#o2">close_lock_count</a>);
00475 }
00476 
00477 
00478 <span class="comment">/* --- clock services --- */</span>
00479 <span class="keyword">static</span> <span class="keyword">inline</span> __u64 <a class="code" href="group__clock.html#ga0">rtdm_clock_read</a>(<span class="keywordtype">void</span>)
00480 {
00481     <span class="keywordflow">return</span> xnpod_ticks2ns(<a class="code" href="group__pod.html#ga51">xnpod_get_time</a>());
00482 }
00483 
00484 
00485 <span class="comment">/* --- spin lock services --- */</span>
<a name="l00526"></a><a class="code" href="group__rtdmsync.html#ga20">00526</a> <span class="preprocessor">#define RTDM_EXECUTE_ATOMICALLY(code_block)                                 \</span>
00527 <span class="preprocessor">{                                                                           \</span>
00528 <span class="preprocessor">    spl_t   s;                                                              \</span>
00529 <span class="preprocessor">                                                                            \</span>
00530 <span class="preprocessor">    xnlock_get_irqsave(&amp;nklock, s);                                         \</span>
00531 <span class="preprocessor">    code_block;                                                             \</span>
00532 <span class="preprocessor">    xnlock_put_irqrestore(&amp;nklock, s);                                      \</span>
00533 <span class="preprocessor">}</span>
00534 <span class="preprocessor"></span>
<a name="l00544"></a><a class="code" href="group__rtdmsync.html#ga21">00544</a> <span class="preprocessor">#define RTDM_LOCK_UNLOCKED          SPIN_LOCK_UNLOCKED</span>
00545 <span class="preprocessor"></span>
<a name="l00547"></a><a class="code" href="group__rtdmsync.html#ga0">00547</a> <span class="keyword">typedef</span> spinlock_t                  <a class="code" href="group__rtdmsync.html#ga0">rtdm_lock_t</a>;
00548 
<a name="l00550"></a><a class="code" href="group__rtdmsync.html#ga1">00550</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>               <a class="code" href="group__rtdmsync.html#ga1">rtdm_lockctx_t</a>;
00551 
<a name="l00567"></a><a class="code" href="group__rtdmsync.html#ga22">00567</a> <span class="preprocessor">#define rtdm_lock_init(lock)        spin_lock_init(lock)</span>
00568 <span class="preprocessor"></span>
<a name="l00585"></a><a class="code" href="group__rtdmsync.html#ga23">00585</a> <span class="preprocessor">#define rtdm_lock_get(lock)         rthal_spin_lock(lock)</span>
00586 <span class="preprocessor"></span>
<a name="l00603"></a><a class="code" href="group__rtdmsync.html#ga24">00603</a> <span class="preprocessor">#define rtdm_lock_put(lock)         rthal_spin_unlock(lock)</span>
00604 <span class="preprocessor"></span>
<a name="l00622"></a><a class="code" href="group__rtdmsync.html#ga25">00622</a> <span class="preprocessor">#define rtdm_lock_get_irqsave(lock, context)    \</span>
00623 <span class="preprocessor">    rthal_spin_lock_irqsave(lock, context)</span>
00624 <span class="preprocessor"></span>
<a name="l00642"></a><a class="code" href="group__rtdmsync.html#ga26">00642</a> <span class="preprocessor">#define rtdm_lock_put_irqrestore(lock, context) \</span>
00643 <span class="preprocessor">    rthal_spin_unlock_irqrestore(lock, context)</span>
00644 <span class="preprocessor"></span>
<a name="l00661"></a><a class="code" href="group__rtdmsync.html#ga27">00661</a> <span class="preprocessor">#define rtdm_lock_irqsave(context)              \</span>
00662 <span class="preprocessor">    rthal_local_irq_save(context)</span>
00663 <span class="preprocessor"></span>
<a name="l00680"></a><a class="code" href="group__rtdmsync.html#ga28">00680</a> <span class="preprocessor">#define rtdm_lock_irqrestore(context)           \</span>
00681 <span class="preprocessor">    rthal_local_irq_restore(context)</span>
00682 <span class="preprocessor"></span>
00687 <span class="comment">/* --- Interrupt management services --- */</span>
00693 <span class="keyword">typedef</span> xnintr_t                    rtdm_irq_t;
00694 
<a name="l00702"></a><a class="code" href="group__rtdmirq.html#ga1">00702</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__rtdmirq.html#ga1">rtdm_irq_handler_t</a>)(rtdm_irq_t *irq_handle);
00703 
00704 
<a name="l00711"></a><a class="code" href="group__rtdmirq.html#ga6">00711</a> <span class="preprocessor">#define RTDM_IRQ_PROPAGATE          XN_ISR_CHAINED</span>
00712 <span class="preprocessor"></span>
<a name="l00713"></a><a class="code" href="group__rtdmirq.html#ga7">00713</a> <span class="preprocessor">#define RTDM_IRQ_ENABLE             XN_ISR_ENABLE</span>
00714 <span class="preprocessor"></span>
<a name="l00733"></a><a class="code" href="group__rtdmirq.html#ga8">00733</a> <span class="preprocessor">#define rtdm_irq_get_arg(irq_handle, type)  ((type *)irq_handle-&gt;cookie)</span>
00734 <span class="preprocessor"></span>
00736 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga2">rtdm_irq_request</a>(rtdm_irq_t *irq_handle,
00737                                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> irq_no,
00738                                    <a class="code" href="group__rtdmirq.html#ga1">rtdm_irq_handler_t</a> handler,
00739                                    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags,
00740                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *device_name,
00741                                    <span class="keywordtype">void</span> *arg)
00742 {
00743     <a class="code" href="group__intr.html#ga2">xnintr_init</a>(irq_handle, irq_no, handler, NULL, flags);
00744     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga4">xnintr_attach</a>(irq_handle, arg);
00745 }
00746 
00747 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga3">rtdm_irq_free</a>(rtdm_irq_t *irq_handle)
00748 {
00749     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga5">xnintr_detach</a>(irq_handle);
00750 }
00751 
00752 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga4">rtdm_irq_enable</a>(rtdm_irq_t *irq_handle)
00753 {
00754     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga6">xnintr_enable</a>(irq_handle);
00755 }
00756 
00757 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga5">rtdm_irq_disable</a>(rtdm_irq_t *irq_handle)
00758 {
00759     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga7">xnintr_disable</a>(irq_handle);
00760 }
00761 
00762 
00763 <span class="comment">/* --- non-real-time signalling services --- */</span>
00764 
00770 <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span>                    rtdm_nrtsig_t;
00771 
<a name="l00781"></a><a class="code" href="group__nrtsignal.html#ga1">00781</a> <span class="keyword">typedef</span> void (*<a class="code" href="group__nrtsignal.html#ga1">rtdm_nrtsig_handler_t</a>)(rtdm_nrtsig_t nrt_sig);
00785 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__nrtsignal.html#ga2">rtdm_nrtsig_init</a>(rtdm_nrtsig_t *nrt_sig,
00786                                    <a class="code" href="group__nrtsignal.html#ga1">rtdm_nrtsig_handler_t</a> handler)
00787 {
00788     *nrt_sig = rthal_alloc_virq();
00789 
00790     <span class="keywordflow">if</span> (*nrt_sig == 0)
00791         <span class="keywordflow">return</span> -EAGAIN;
00792 
00793     rthal_virtualize_irq(rthal_root_domain, *nrt_sig, handler, NULL,
00794                          IPIPE_HANDLE_MASK);
00795     <span class="keywordflow">return</span> 0;
00796 }
00797 
00798 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__nrtsignal.html#ga3">rtdm_nrtsig_destroy</a>(rtdm_nrtsig_t *nrt_sig)
00799 {
00800     rthal_free_virq(*nrt_sig);
00801 }
00802 
00803 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__nrtsignal.html#ga4">rtdm_nrtsig_pend</a>(rtdm_nrtsig_t *nrt_sig)
00804 {
00805     rthal_trigger_irq(*nrt_sig);
00806 }
00807 
00808 
00809 <span class="comment">/* --- task and timing services --- */</span>
00815 <span class="keyword">typedef</span> xnthread_t                  rtdm_task_t;
00816 
<a name="l00822"></a><a class="code" href="group__rtdmtask.html#ga1">00822</a> <span class="keyword">typedef</span> void (*<a class="code" href="group__rtdmtask.html#ga1">rtdm_task_proc_t</a>)(<span class="keywordtype">void</span> *arg);
00823 
00824 
00829 <span class="preprocessor">#define RTDM_TASK_LOWEST_PRIORITY   FUSION_LOW_PRIO</span>
00830 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_TASK_HIGHEST_PRIORITY  FUSION_HIGH_PRIO</span>
00831 <span class="preprocessor"></span>
00835 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga2">rtdm_task_init</a>(rtdm_task_t *task, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00836                                  <a class="code" href="group__rtdmtask.html#ga1">rtdm_task_proc_t</a> task_proc, <span class="keywordtype">void</span> *arg,
00837                                  <span class="keywordtype">int</span> priority, __u64 period)
00838 {
00839     <span class="keywordtype">int</span> res;
00840 
00841     res = <a class="code" href="group__pod.html#ga28">xnpod_init_thread</a>(task, name, priority, 0, 0);
00842     <span class="keywordflow">if</span> (res)
00843         <span class="keywordflow">goto</span> done;
00844 
00845     <span class="keywordflow">if</span> (!__builtin_constant_p(period) || (period != XN_INFINITE)) {
00846         res = <a class="code" href="group__pod.html#ga49">xnpod_set_thread_periodic</a>(task, XN_INFINITE,
00847                                         xnpod_ns2ticks(period));
00848         <span class="keywordflow">if</span> (res)
00849             <span class="keywordflow">goto</span> done;
00850     }
00851 
00852     res = <a class="code" href="group__pod.html#ga29">xnpod_start_thread</a>(task, 0, 0, XNPOD_ALL_CPUS, task_proc, arg);
00853 
00854   done:
00855     <span class="keywordflow">return</span> res;
00856 }
00857 
00858 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga3">rtdm_task_destroy</a>(rtdm_task_t *task)
00859 {
00860     <a class="code" href="group__pod.html#ga31">xnpod_delete_thread</a>(task);
00861 }
00862 
00863 <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga9">rtdm_task_join_nrt</a>(rtdm_task_t *task, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poll_delay);
00864 
00865 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga4">rtdm_task_set_priority</a>(rtdm_task_t *task, <span class="keywordtype">int</span> priority)
00866 {
00867     <a class="code" href="group__pod.html#ga36">xnpod_renice_thread</a>(task, priority);
00868     <a class="code" href="group__pod.html#ga39">xnpod_schedule</a>();
00869 }
00870 
00871 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga5">rtdm_task_set_period</a>(rtdm_task_t *task, __u64 period)
00872 {
00873     <span class="keywordflow">return</span> <a class="code" href="group__pod.html#ga49">xnpod_set_thread_periodic</a>(task, XN_INFINITE,
00874                                      xnpod_ns2ticks(period));
00875 }
00876 
00877 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga7">rtdm_task_unblock</a>(rtdm_task_t *task)
00878 {
00879     <span class="keywordtype">int</span> res = <a class="code" href="group__pod.html#ga35">xnpod_unblock_thread</a>(task);
00880 
00881     <a class="code" href="group__pod.html#ga39">xnpod_schedule</a>();
00882     <span class="keywordflow">return</span> res;
00883 }
00884 
00885 <span class="keyword">static</span> <span class="keyword">inline</span> rtdm_task_t *<a class="code" href="group__rtdmtask.html#ga8">rtdm_task_current</a>(<span class="keywordtype">void</span>)
00886 {
00887     <span class="keywordflow">return</span> xnpod_current_thread();
00888 }
00889 
00890 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga6">rtdm_task_wait_period</a>(<span class="keywordtype">void</span>)
00891 {
00892     <span class="keywordflow">return</span> <a class="code" href="group__pod.html#ga50">xnpod_wait_thread_period</a>();
00893 }
00894 
00895 <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga10">rtdm_task_sleep</a>(__u64 delay);
00896 <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga11">rtdm_task_sleep_until</a>(__u64 wakeup_time);
00897 <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga12">rtdm_task_busy_sleep</a>(__u64 delay);
00898 
00899 
00900 <span class="comment">/* --- timeout sequences */</span>
00901 
00902 <span class="keyword">typedef</span> __u64                       rtdm_toseq_t;
00903 
00904 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga2">rtdm_toseq_init</a>(rtdm_toseq_t *timeout_seq, __s64 timeout)
00905 {
00906     *timeout_seq = <a class="code" href="group__pod.html#ga51">xnpod_get_time</a>() + xnpod_ns2ticks(timeout);
00907 }
00908 
00909 
00910 <span class="comment">/* --- event services --- */</span>
00911 
00912 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00913     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   pending;
00914     xnsynch_t                       synch_base;
00915 } rtdm_event_t;
00916 
00917 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga3">rtdm_event_init</a>(rtdm_event_t *event, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> pending)
00918 {
00919     event-&gt;pending = pending;
00920     <a class="code" href="group__synch.html#ga0">xnsynch_init</a>(&amp;event-&gt;synch_base, XNSYNCH_PRIO);
00921 }
00922 
00923 <span class="keywordtype">void</span> _rtdm_synch_flush(xnsynch_t *synch, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> reason);
00924 
00925 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga4">rtdm_event_destroy</a>(rtdm_event_t *event)
00926 {
00927     _rtdm_synch_flush(&amp;event-&gt;synch_base, XNRMID);
00928 }
00929 
00930 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga8">rtdm_event_wait</a>(rtdm_event_t *event);
00931 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga9">rtdm_event_timedwait</a>(rtdm_event_t *event, __s64 timeout,
00932                          rtdm_toseq_t *timeout_seq);
00933 <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga7">rtdm_event_signal</a>(rtdm_event_t *event);
00934 
00935 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga5">rtdm_event_pulse</a>(rtdm_event_t *event)
00936 {
00937     _rtdm_synch_flush(&amp;event-&gt;synch_base, 0);
00938 }
00939 
00940 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga6">rtdm_event_clear</a>(rtdm_event_t *event)
00941 {
00942     event-&gt;pending = 0;
00943 }
00944 
00945 
00946 <span class="comment">/* --- semaphore services --- */</span>
00947 
00948 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00949     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   value;
00950     xnsynch_t                       synch_base;
00951 } rtdm_sem_t;
00952 
00953 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga10">rtdm_sem_init</a>(rtdm_sem_t *sem, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> value)
00954 {
00955     sem-&gt;value = value;
00956     <a class="code" href="group__synch.html#ga0">xnsynch_init</a>(&amp;sem-&gt;synch_base, XNSYNCH_PRIO);
00957 }
00958 
00959 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga11">rtdm_sem_destroy</a>(rtdm_sem_t *sem)
00960 {
00961     _rtdm_synch_flush(&amp;sem-&gt;synch_base, XNRMID);
00962 }
00963 
00964 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga12">rtdm_sem_down</a>(rtdm_sem_t *sem);
00965 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga13">rtdm_sem_timeddown</a>(rtdm_sem_t *sem, __s64 timeout,
00966                        rtdm_toseq_t *timeout_seq);
00967 <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga14">rtdm_sem_up</a>(rtdm_sem_t *sem);
00968 
00969 
00970 <span class="comment">/* --- mutex services --- */</span>
00971 
00972 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00973     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   locked;
00974     xnsynch_t                       synch_base;
00975 } rtdm_mutex_t;
00976 
00977 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga15">rtdm_mutex_init</a>(rtdm_mutex_t *mutex)
00978 {
00979     mutex-&gt;locked = 0;
00980     <a class="code" href="group__synch.html#ga0">xnsynch_init</a>(&amp;mutex-&gt;synch_base, XNSYNCH_PRIO|XNSYNCH_PIP);
00981 }
00982 
00983 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga16">rtdm_mutex_destroy</a>(rtdm_mutex_t *mutex)
00984 {
00985     _rtdm_synch_flush(&amp;mutex-&gt;synch_base, XNRMID);
00986 }
00987 
00988 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga17">rtdm_mutex_lock</a>(rtdm_mutex_t *mutex);
00989 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga18">rtdm_mutex_timedlock</a>(rtdm_mutex_t *mutex, __s64 timeout,
00990                          rtdm_toseq_t *timeout_seq);
00991 <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga19">rtdm_mutex_unlock</a>(rtdm_mutex_t *mutex);
00992 
00993 
00994 <span class="comment">/* --- utility functions --- */</span>
00995 
00996 <span class="preprocessor">#define rtdm_printk(format, ...)    printk(format, ##__VA_ARGS__)</span>
00997 <span class="preprocessor"></span>
00998 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> *<a class="code" href="group__util.html#ga1">rtdm_malloc</a>(size_t size)
00999 {
01000     <span class="keywordflow">return</span> xnmalloc(size);
01001 }
01002 
01003 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__util.html#ga2">rtdm_free</a>(<span class="keywordtype">void</span> *ptr)
01004 {
01005     xnfree(ptr);
01006 }
01007 
01008 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga3">rtdm_read_user_ok</a>(rtdm_user_info_t *user_info,
01009                                     <span class="keyword">const</span> <span class="keywordtype">void</span> __user *ptr, size_t size)
01010 {
01011     <span class="keywordflow">return</span> __xn_access_ok(user_info, VERIFY_READ, ptr, size);
01012 }
01013 
01014 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga4">rtdm_rw_user_ok</a>(rtdm_user_info_t *user_info,
01015                                   <span class="keyword">const</span> <span class="keywordtype">void</span> __user *ptr, size_t size)
01016 {
01017     <span class="keywordflow">return</span> __xn_access_ok(user_info, VERIFY_WRITE, ptr, size);
01018 }
01019 
01020 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga5">rtdm_copy_from_user</a>(rtdm_user_info_t *user_info,
01021                                       <span class="keywordtype">void</span> *dst, <span class="keyword">const</span> <span class="keywordtype">void</span> __user *src,
01022                                       size_t size)
01023 {
01024     <span class="keywordflow">return</span> __xn_copy_from_user(user_info, dst, src, size);
01025 }
01026 
01027 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga6">rtdm_copy_to_user</a>(rtdm_user_info_t *user_info,
01028                                     <span class="keywordtype">void</span> __user *dst, <span class="keyword">const</span> <span class="keywordtype">void</span> *src,
01029                                     size_t size)
01030 {
01031     <span class="keywordflow">return</span> __xn_copy_to_user(user_info, dst, src, size);
01032 }
01033 
01034 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga7">rtdm_strncpy_from_user</a>(rtdm_user_info_t *user_info,
01035                                          <span class="keywordtype">char</span> *dst,
01036                                          <span class="keyword">const</span> <span class="keywordtype">char</span> __user *src,
01037                                          size_t count)
01038 {
01039     <span class="keywordflow">if</span> (unlikely(__xn_access_ok(user_info, VERIFY_READ, src, 1)))
01040         <span class="keywordflow">return</span> -EFAULT;
01041     <span class="keywordflow">return</span> __xn_strncpy_from_user(user_info, dst, src, count);
01042 }
01043 
01044 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga8">rtdm_in_rt_context</a>(<span class="keywordtype">void</span>)
01045 {
01046     <span class="keywordflow">return</span> (rthal_current_domain != rthal_root_domain);
01047 }
01048 
01049 <span class="keywordtype">int</span> rtdm_exec_in_rt(<span class="keyword">struct</span> <a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *context,
01050                     rtdm_user_info_t *user_info, <span class="keywordtype">void</span> *arg,
01051                     rtdm_rt_handler_t handler);
01052 
01053 <span class="preprocessor">#endif </span><span class="comment">/* _RTDM_DRIVER_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 3 12:32:47 2005 for RTAI Fusion API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
