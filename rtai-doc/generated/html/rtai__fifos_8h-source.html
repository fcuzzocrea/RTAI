<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTAI API: rtai-core/include/rtai_fifos.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>rtai-core/include/rtai_fifos.h</h1><a href="rtai__fifos_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00026 <span class="preprocessor">#ifndef _RTAI_FIFOS_H</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define _RTAI_FIFOS_H</span>
00028 <span class="preprocessor"></span>
00029 <span class="preprocessor">#include &lt;rtai_types.h&gt;</span>
00030 
00031 <span class="preprocessor">#define MAX_FIFOS 64</span>
00032 <span class="preprocessor"></span>
00033 <span class="preprocessor">#define RTAI_FIFOS_MAJOR 150</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#define RESET                   1</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define RESIZE                  2</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#define SUSPEND_TIMED           3</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define OPEN_SIZED              4</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define READ_ALL_AT_ONCE        5</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define READ_TIMED              6</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_TIMED             7</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_INIT            8</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_WAIT            9</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_TRYWAIT         10</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_TIMED_WAIT      11</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_POST            12</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_DESTROY         13</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#define SET_ASYNC_SIG           14</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#define EAVESDROP               19</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#define OVRWRITE                20</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#define READ_IF                 21</span>
00052 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_IF                22</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#define RTF_NAMED_CREATE        23</span>
00054 <span class="preprocessor"></span>
00055 <span class="preprocessor">#define RTF_GET_N_FIFOS         15</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#define RTF_GET_FIFO_INFO       16</span>
00057 <span class="preprocessor"></span><span class="preprocessor">#define RTF_CREATE_NAMED        17</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#define RTF_NAME_LOOKUP         18</span>
00059 <span class="preprocessor"></span>
00060 <span class="preprocessor">#define RTF_NAMELEN 15</span>
00061 <span class="preprocessor"></span>
00062 <span class="keyword">struct </span>rt_fifo_info_struct{
00063         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo_number;
00064         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size;
00065         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> opncnt;
00066         <span class="keywordtype">char</span> name[RTF_NAMELEN+1];
00067 };
00068 
00069 <span class="keyword">struct </span>rt_fifo_get_info_struct{
00070         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo;
00071         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n;
00072         <span class="keyword">struct </span>rt_fifo_info_struct *ptr;
00073 };
00074 
00075 <span class="preprocessor">#define  FUN_FIFOS_LXRT_INDX 10</span>
00076 <span class="preprocessor"></span>
00077 <span class="preprocessor">#define _CREATE         0</span>
00078 <span class="preprocessor"></span><span class="preprocessor">#define _DESTROY        1</span>
00079 <span class="preprocessor"></span><span class="preprocessor">#define _PUT            2</span>
00080 <span class="preprocessor"></span><span class="preprocessor">#define _GET            3</span>
00081 <span class="preprocessor"></span><span class="preprocessor">#define _RESET          4</span>
00082 <span class="preprocessor"></span><span class="preprocessor">#define _RESIZE         5</span>
00083 <span class="preprocessor"></span><span class="preprocessor">#define _SEM_INIT       6</span>
00084 <span class="preprocessor"></span><span class="preprocessor">#define _SEM_DESTRY     7</span>
00085 <span class="preprocessor"></span><span class="preprocessor">#define _SEM_POST       8</span>
00086 <span class="preprocessor"></span><span class="preprocessor">#define _SEM_TRY        9</span>
00087 <span class="preprocessor"></span><span class="preprocessor">#define _CREATE_NAMED  10</span>
00088 <span class="preprocessor"></span><span class="preprocessor">#define _GETBY_NAME    11</span>
00089 <span class="preprocessor"></span><span class="preprocessor">#define _OVERWRITE     12</span>
00090 <span class="preprocessor"></span><span class="preprocessor">#define _PUT_IF        13</span>
00091 <span class="preprocessor"></span><span class="preprocessor">#define _GET_IF        14</span>
00092 <span class="preprocessor"></span><span class="preprocessor">#define _NAMED_CREATE  15</span>
00093 <span class="preprocessor"></span>
00094 <span class="preprocessor">#ifdef __KERNEL__</span>
00095 <span class="preprocessor"></span>
00096 <span class="preprocessor">#ifdef CONFIG_RTAI_FIFOS_BUILTIN</span>
00097 <span class="preprocessor"></span><span class="preprocessor">#define FIFOS_INIT_MODULE     fifos_init_module</span>
00098 <span class="preprocessor"></span><span class="preprocessor">#define FIFOS_CLEANUP_MODULE  fifos_cleanup_module</span>
00099 <span class="preprocessor"></span><span class="preprocessor">#else  </span><span class="comment">/* !CONFIG_RTAI_FIFOS_BUILTIN */</span>
00100 <span class="preprocessor">#define FIFOS_INIT_MODULE     init_module</span>
00101 <span class="preprocessor"></span><span class="preprocessor">#define FIFOS_CLEANUP_MODULE  cleanup_module</span>
00102 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* CONFIG_RTAI_FIFOS_BUILTIN */</span>
00103 
00104 <span class="preprocessor">#ifdef __cplusplus</span>
00105 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00106 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00107 
00108 <span class="keywordtype">int</span> FIFOS_INIT_MODULE(<span class="keywordtype">void</span>);
00109 
00110 <span class="keywordtype">void</span> FIFOS_CLEANUP_MODULE(<span class="keywordtype">void</span>);
00111 
00112 <span class="keywordtype">int</span> rtf_init(<span class="keywordtype">void</span>);
00113 
00114 <span class="comment">/* Attach a handler to an RT-FIFO.</span>
00115 <span class="comment"> *</span>
00116 <span class="comment"> * Allow function handler to be called when a user process reads or writes to </span>
00117 <span class="comment"> * the FIFO. When the function is called, it is passed the fifo number as the </span>
00118 <span class="comment"> * argument.</span>
00119 <span class="comment"> */</span>
00120 
00121 <span class="keywordtype">int</span> <a class="code" href="group__fifos__ipc.html#a10">rtf_create_handler</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,       <span class="comment">/* RT-FIFO */</span>
00122                        <span class="keywordtype">int</span> (*handler)(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo)        <span class="comment">/* function to be called */</span>);
00123 
00124 
00137 <span class="preprocessor">#define X_FIFO_HANDLER(handler) ((int (*)(unsigned int))(handler))</span>
00138 <span class="preprocessor"></span>
00139 <span class="comment">/* Create an RT-FIFO.</span>
00140 <span class="comment"> * </span>
00141 <span class="comment"> * An RT-FIFO fifo is created with initial size of size.</span>
00142 <span class="comment"> * Return value: On success, 0 is returned. On error, -1 is returned.</span>
00143 <span class="comment"> */</span>
00144 <span class="preprocessor">#undef rtf_create</span>
00145 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="fifos_8c.html#a64">rtf_create</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">int</span> size);
00146 
00147 <span class="comment">/* Create an RT-FIFO with a name and size.</span>
00148 <span class="comment"> *</span>
00149 <span class="comment"> * An RT-FIFO is created with a name of name, it will be allocated</span>
00150 <span class="comment"> * the first unused minor number and will have a user assigned size.</span>
00151 <span class="comment"> * Return value: On success, the allocated minor number is returned.</span>
00152 <span class="comment"> *               On error, -errno is returned.</span>
00153 <span class="comment"> */</span>
00154 
00155 <span class="keywordtype">int</span> rtf_named_create(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> size);
00156 
00157 <span class="comment">/* Create an RT-FIFO with a name.</span>
00158 <span class="comment"> *</span>
00159 <span class="comment"> * An RT-FIFO is created with a name of name, it will be allocated</span>
00160 <span class="comment"> * the first unused minor number and will have a default size.</span>
00161 <span class="comment"> * Return value: On success, the allocated minor number is returned. </span>
00162 <span class="comment"> *               On error, -errno is returned.</span>
00163 <span class="comment"> */</span>
00164 
00165 <span class="keywordtype">int</span> rtf_create_named(<span class="keyword">const</span> <span class="keywordtype">char</span> *name);
00166 
00167 <span class="comment">/* Look up a named RT-FIFO.</span>
00168 <span class="comment"> *</span>
00169 <span class="comment"> * Find the RT-FIFO with the name name.</span>
00170 <span class="comment"> * Return value: On success, the minor number is returned. </span>
00171 <span class="comment"> *               On error, -errno is returned.</span>
00172 <span class="comment"> */</span>
00173 
00174 <span class="keywordtype">int</span> rtf_getfifobyname(<span class="keyword">const</span> <span class="keywordtype">char</span> *name);
00175 
00176 <span class="comment">/* Reset an RT-FIFO.</span>
00177 <span class="comment"> * </span>
00178 <span class="comment"> * An RT-FIFO fifo is reset by setting its buffer pointers to zero, so</span>
00179 <span class="comment"> * that any existing data is discarded and the fifo started anew like at its</span>
00180 <span class="comment"> * creation.</span>
00181 <span class="comment"> */</span>
00182 
00183 <span class="keywordtype">int</span> <a class="code" href="group__fifos__ipc.html#a6">rtf_reset</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo);
00184 
00185 <span class="comment">/* destroy an RT-FIFO.</span>
00186 <span class="comment"> * </span>
00187 <span class="comment"> * Return value: On success, 0 is returned.</span>
00188 <span class="comment"> */</span>
00189 
00190 <span class="keywordtype">int</span> <a class="code" href="fifos_8c.html#a65">rtf_destroy</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo);
00191 
00192 
00193 <span class="comment">/* Resize an RT-FIFO.</span>
00194 <span class="comment"> * </span>
00195 <span class="comment"> * Return value: size is returned on success. On error, a negative value</span>
00196 <span class="comment"> * is returned.</span>
00197 <span class="comment"> */</span>
00198 
00199 <span class="keywordtype">int</span> <a class="code" href="group__fifos__ipc.html#a7">rtf_resize</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> minor, <span class="keywordtype">int</span> size);
00200 
00201 
00202 <span class="comment">/* Write to an RT-FIFO.</span>
00203 <span class="comment"> *</span>
00204 <span class="comment"> * Try to write count bytes to an FIFO. Returns the number of bytes written.</span>
00205 <span class="comment"> */</span>
00206 
00207 <span class="keywordtype">int</span> <a class="code" href="group__fifos__ipc.html#a11">rtf_put</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,  <span class="comment">/* RT-FIFO */</span>
00208             <span class="keywordtype">void</span> * buf,         <span class="comment">/* buffer address */</span>
00209             <span class="keywordtype">int</span> count           <span class="comment">/* number of bytes to write */</span>);
00210 
00211 
00212 
00213 <span class="comment">/* Write to an RT-FIFO, over writing if there is not enough space.</span>
00214 <span class="comment"> *</span>
00215 <span class="comment"> * Try to write count bytes to an FIFO. Returns 0.</span>
00216 <span class="comment"> */</span>
00217 
00218 <span class="keywordtype">int</span> rtf_ovrwr_put(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,    <span class="comment">/* RT-FIFO */</span>
00219                   <span class="keywordtype">void</span> * buf,           <span class="comment">/* buffer address */</span>
00220                   <span class="keywordtype">int</span> count             <span class="comment">/* number of bytes to write */</span>);
00221 
00222 
00223 
00224 <span class="comment">/* Write atomically to an RT-FIFO.</span>
00225 <span class="comment"> *</span>
00226 <span class="comment"> * Try to write count bytes in block to an FIFO. Returns the number of bytes</span>
00227 <span class="comment"> * written.</span>
00228 <span class="comment"> */</span>
00229 
00230 <span class="keyword">extern</span> <span class="keywordtype">int</span> rtf_put_if (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,       <span class="comment">/* RT-FIFO */</span>
00231                 <span class="keywordtype">void</span> * buf,                     <span class="comment">/* buffer address */</span>
00232                 <span class="keywordtype">int</span> count                       <span class="comment">/* number of bytes to write */</span>);
00233 
00234 <span class="comment">/* Read from an RT-FIFO.</span>
00235 <span class="comment"> *</span>
00236 <span class="comment"> * Try to read count bytes from a FIFO. Returns the number of bytes read.</span>
00237 <span class="comment"> */</span>
00238 
00239 <span class="keywordtype">int</span> <a class="code" href="fifos_8c.html#a70">rtf_get</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,  <span class="comment">/* RT-FIFO */</span>
00240             <span class="keywordtype">void</span> * buf,                 <span class="comment">/* buffer address */</span>
00241             <span class="keywordtype">int</span> count           <span class="comment">/* number of bytes to read */</span>);
00242 
00243 
00244 <span class="comment">/* Atomically read from an RT-FIFO.</span>
00245 <span class="comment"> *</span>
00246 <span class="comment"> * Try to read count bytes in a block from an FIFO. Returns the number of bytes read.</span>
00247 <span class="comment"> */</span>
00248 
00249 <span class="keywordtype">int</span> rtf_get_if(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,       <span class="comment">/* RT-FIFO */</span>
00250             <span class="keywordtype">void</span> * buf,                 <span class="comment">/* buffer address */</span>
00251             <span class="keywordtype">int</span> count           <span class="comment">/* number of bytes to read */</span>);
00252 
00253 
00254 <span class="comment">/* </span>
00255 <span class="comment"> * Preview the an RT-FIFO content.</span>
00256 <span class="comment"> */</span>
00257 
00258 <span class="keywordtype">int</span> rtf_evdrp(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,        <span class="comment">/* RT-FIFO */</span>
00259               <span class="keywordtype">void</span> * buf,               <span class="comment">/* buffer address */</span>
00260               <span class="keywordtype">int</span> count         <span class="comment">/* number of bytes to read */</span>);
00261 
00262 <span class="comment">/* Open an RT-FIFO semaphore.</span>
00263 <span class="comment"> *</span>
00264 <span class="comment"> */</span>
00265 
00266 <span class="keywordtype">int</span> <a class="code" href="group__fifos__sem.html#a2">rtf_sem_init</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,     <span class="comment">/* RT-FIFO */</span>
00267                  <span class="keywordtype">int</span> value                      <span class="comment">/* initial semaphore value */</span>);
00268 
00269 
00270 <span class="comment">/* Post to an RT-FIFO semaphore.</span>
00271 <span class="comment"> *</span>
00272 <span class="comment"> */</span>
00273 
00274 <span class="keywordtype">int</span> <a class="code" href="group__fifos__sem.html#a3">rtf_sem_post</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo      <span class="comment">/* RT-FIFO */</span>);
00275 
00276 
00277 <span class="comment">/* Try to acquire an RT-FIFO semaphore.</span>
00278 <span class="comment"> *</span>
00279 <span class="comment"> */</span>
00280 
00281 <span class="keywordtype">int</span> <a class="code" href="group__fifos__sem.html#a4">rtf_sem_trywait</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo   <span class="comment">/* RT-FIFO */</span>);
00282 
00283 
00284 <span class="comment">/* Destroy an RT-FIFO semaphore.</span>
00285 <span class="comment"> *</span>
00286 <span class="comment"> */</span>
00287 
00288 <span class="keywordtype">int</span> <a class="code" href="group__fifos__sem.html#a5">rtf_sem_destroy</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo   <span class="comment">/* RT-FIFO */</span>);
00289 
00290 <span class="preprocessor">#define rtf_sem_delete rtf_sem_destroy</span>
00291 <span class="preprocessor"></span>
00292 <span class="comment">/* Just for compatibility with earlier rtai_fifos releases. No more bh and user</span>
00293 <span class="comment">buffers. Fifos are now awakened immediately and buffers &gt; 128K are vmalloced */</span>
00294 
00295 <span class="preprocessor">#define rtf_create_using_bh(fifo, size, bh_list) rtf_create(fifo, size)</span>
00296 <span class="preprocessor"></span><span class="preprocessor">#define rtf_create_using_bh_and_usr_buf(fifo, buf, size, bh_list) rtf_create(fifo, size)</span>
00297 <span class="preprocessor"></span><span class="preprocessor">#define rtf_destroy_using_usr_buf(fifo) rtf_destroy(fifo)</span>
00298 <span class="preprocessor"></span>
00299 <span class="preprocessor">#ifdef __cplusplus</span>
00300 <span class="preprocessor"></span>}
00301 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00302 
00303 <span class="preprocessor">#else  </span><span class="comment">/* !__KERNEL__ */</span>
00304 
00305 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00306 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00307 <span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span>
00308 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00309 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00310 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00311 <span class="preprocessor">#include &lt;string.h&gt;</span>
00312 <span class="preprocessor">#include &lt;<a class="code" href="rtai__lxrt_8h.html">rtai_lxrt.h</a>&gt;</span>
00313 
00314 <span class="preprocessor">#ifdef __cplusplus</span>
00315 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00316 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00317 
<a name="l00318"></a><a class="code" href="group__fifos__ipc.html#a8">00318</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_create,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">int</span> size))
00319 {
00320         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, size; } arg = { fifo, size }; 
00321         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _CREATE, &amp;arg).i[LOW];
00322 }
00323 
<a name="l00324"></a><a class="code" href="group__fifos__ipc.html#a9">00324</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_destroy,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo))
00325 {
00326         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; } arg = { fifo };
00327         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _DESTROY, &amp;arg).i[LOW];
00328 }
00329 
00330 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_put,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00331 {
00332         <span class="keywordtype">char</span> lbuf[count];
00333         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } arg = { fifo, lbuf, count };
00334         memcpy(lbuf, buf, count);
00335         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _PUT, &amp;arg).i[LOW];
00336 }
00337 
00338 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_put_if,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00339 {
00340         <span class="keywordtype">char</span> lbuf[count];
00341         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } arg = { fifo, lbuf, count };
00342         memcpy(lbuf, buf, count);
00343         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _PUT_IF, &amp;arg).i[LOW];
00344 }
00345 
<a name="l00346"></a><a class="code" href="group__fifos__ipc.html#a12">00346</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_get,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00347 {
00348         <span class="keywordtype">int</span> retval;
00349         <span class="keywordtype">char</span> lbuf[count];
00350         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } arg = { fifo, lbuf, count };
00351         retval = rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _GET, &amp;arg).i[LOW];
00352         <span class="keywordflow">if</span> (retval &gt; 0) {
00353                 memcpy(buf, lbuf, retval);
00354         }
00355         <span class="keywordflow">return</span> retval;
00356 }
00357 
00358 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_get_if,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00359 {
00360         <span class="keywordtype">int</span> retval;
00361         <span class="keywordtype">char</span> lbuf[count];
00362         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } arg = { fifo, lbuf, count };
00363         retval = rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _GET_IF, &amp;arg).i[LOW];
00364         <span class="keywordflow">if</span> (retval &gt; 0) {
00365                 memcpy(buf, lbuf, retval);
00366         }
00367         <span class="keywordflow">return</span> retval;
00368 }
00369 
00370 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_reset_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo))
00371 {
00372         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; } arg = { fifo };
00373         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _RESET, &amp;arg).i[LOW];
00374 }
00375 
00376 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_resize_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">int</span> size))
00377 {
00378         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, size; } arg = { fifo, size }; 
00379         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _RESIZE, &amp;arg).i[LOW];
00380 }
00381 
00382 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_init_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">int</span> value))
00383 {
00384         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, value; } arg = { fifo, value }; 
00385         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _SEM_INIT, &amp;arg).i[LOW];
00386 }
00387 
00388 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_post_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo))
00389 {
00390         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; } arg = { fifo }; 
00391         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _SEM_POST, &amp;arg).i[LOW];
00392 }
00393 
00394 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_trywait_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo))
00395 {
00396         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; } arg = { fifo }; 
00397         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _SEM_TRY, &amp;arg).i[LOW];
00398 }
00399 
00400 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_destroy_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo))
00401 {
00402         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; } arg = { fifo }; 
00403         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _SEM_DESTRY, &amp;arg).i[LOW];
00404 }
00405 
00406 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_named_create_lxrt,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> size))
00407 {
00408         <span class="keywordtype">int</span> len;
00409         <span class="keywordtype">char</span> lname[len = strlen(name)];
00410         <span class="keyword">struct </span>{ <span class="keywordtype">char</span> * name; <span class="keywordtype">int</span> size; } arg = { lname, size };
00411         strncpy(lname, name, len);
00412         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _NAMED_CREATE, &amp;arg).i[LOW];
00413 }
00414 
00415 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_create_named_lxrt,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name))
00416 {
00417         <span class="keywordtype">int</span> len;
00418         <span class="keywordtype">char</span> lname[len = strlen(name)];
00419         <span class="keyword">struct </span>{ <span class="keywordtype">char</span> * name; } arg = { lname };
00420         strncpy(lname, name, len);
00421         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _CREATE_NAMED, &amp;arg).i[LOW];
00422 }
00423 
00424 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_getfifobyname_lxrt,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name))
00425 {
00426         <span class="keywordtype">int</span> len;
00427         <span class="keywordtype">char</span> lname[len = strlen(name)];
00428         <span class="keyword">struct </span>{ <span class="keywordtype">char</span> * name; } arg = { lname };
00429         strncpy(lname, name, len);
00430         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _GETBY_NAME, &amp;arg).i[LOW];
00431 }
00432 
00433 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_ovrwr_put,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00434 {
00435         <span class="keywordtype">char</span> lbuf[count];
00436         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } arg = { fifo, lbuf, count };
00437         memcpy(lbuf, buf, count);
00438         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _OVERWRITE, &amp;arg).i[LOW];
00439 }
00440 
00441 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_reset,(<span class="keywordtype">int</span> fd))
00442 {
00443         <span class="keywordtype">int</span> ret = ioctl(fd, RESET);
00444         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00445 }
00446 
00447 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_resize,(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> size))
00448 {
00449         <span class="keywordtype">int</span> ret = ioctl(fd, RESIZE, size);
00450         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00451 }
00452 
<a name="l00467"></a><a class="code" href="group__fifos__ipc.html#a0">00467</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_suspend_timed,(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> ms_delay))
00468 {
00469         <span class="keywordtype">int</span> ret = ioctl(fd, SUSPEND_TIMED, ms_delay);
00470         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00471 }
00472 
<a name="l00507"></a><a class="code" href="group__fifos__ipc.html#a1">00507</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_open_sized,(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keywordtype">int</span> perm, <span class="keywordtype">int</span> size))
00508 {
00509         <span class="keywordtype">int</span> fd;
00510 
00511         <span class="keywordflow">if</span> ((fd = open(dev, perm)) &lt; 0) { 
00512                 <span class="keywordflow">return</span> -errno;
00513         }
00514         <span class="keywordflow">if</span> (ioctl(fd, RESIZE, size) &lt; 0) {
00515                 close(fd);
00516                 <span class="keywordflow">return</span> -errno;
00517         }
00518         <span class="keywordflow">return</span> fd; 
00519 }
00520 
00521 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_evdrp,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00522 {
00523         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } args = { buf, count };
00524         <span class="keywordtype">int</span> ret = ioctl(fd, EAVESDROP, &amp;args);
00525         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00526 }
00527 
<a name="l00544"></a><a class="code" href="group__fifos__ipc.html#a2">00544</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_read_all_at_once,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00545 {
00546         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } args = { buf, count };
00547         <span class="keywordtype">int</span> ret = ioctl(fd, READ_ALL_AT_ONCE, &amp;args);
00548         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00549 }
00550 
<a name="l00572"></a><a class="code" href="group__fifos__ipc.html#a3">00572</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_read_timed,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> ms_delay))
00573 {
00574         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count, delay; } args = { buf, count, ms_delay };
00575         <span class="keywordtype">int</span> ret = ioctl(fd, READ_TIMED, &amp;args);
00576         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00577 }
00578 
00579 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_read_if,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00580 {
00581         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } args = { buf, count };
00582         <span class="keywordtype">int</span> ret = ioctl(fd, READ_IF, &amp;args);
00583         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00584 }
00585 
<a name="l00607"></a><a class="code" href="group__fifos__ipc.html#a4">00607</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_write_timed,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> ms_delay))
00608 {
00609         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count, delay; } args = { buf, count, ms_delay };
00610         <span class="keywordtype">int</span> ret = ioctl(fd, WRITE_TIMED, &amp;args);
00611         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00612 }
00613 
00614 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_overwrite,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00615 {
00616         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } args = { buf, count };
00617         <span class="keywordtype">int</span> ret = ioctl(fd, OVRWRITE, &amp;args);
00618         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00619 }
00620 
00621 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_write_if,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00622 {
00623         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } args = { buf, count };
00624         <span class="keywordtype">int</span> ret = ioctl(fd, WRITE_IF, &amp;args);
00625         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00626 }
00627 
00628 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_init,(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> value))
00629 {
00630         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_INIT, value);
00631         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00632 }
00633 
<a name="l00656"></a><a class="code" href="group__fifos__sem.html#a0">00656</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_wait,(<span class="keywordtype">int</span> fd))
00657 {
00658         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_WAIT);
00659         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00660 }
00661 
00662 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_trywait,(<span class="keywordtype">int</span> fd))
00663 {
00664         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_TRYWAIT);
00665         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00666 }
00667 
<a name="l00694"></a><a class="code" href="group__fifos__sem.html#a1">00694</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_timed_wait,(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> ms_delay))
00695 {
00696         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_TIMED_WAIT, ms_delay);
00697         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00698 }
00699 
00700 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_post,(<span class="keywordtype">int</span> fd))
00701 {
00702         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_POST);
00703         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00704 }
00705 
00706 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_destroy,(<span class="keywordtype">int</span> fd))
00707 {
00708         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_DESTROY);
00709         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00710 }
00711 
<a name="l00723"></a><a class="code" href="group__fifos__ipc.html#a5">00723</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_set_async_sig,(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> signum))
00724 {
00725         <span class="keywordtype">int</span> ret = ioctl(fd, SET_ASYNC_SIG, signum);
00726         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00727 }
00728 
00729 <span class="comment">/*</span>
00730 <span class="comment"> * Support for named FIFOS : Ian Soanes (ians@zentropix.com)</span>
00731 <span class="comment"> * Based on ideas from Stuart Hughes and David Schleef</span>
00732 <span class="comment"> */</span>
00733 
00734 RTAI_PROTO_ALWAYS_INLINE(<span class="keywordtype">char</span> *, rtf_getfifobyminor,(<span class="keywordtype">int</span> minor, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> len))
00735 {
00736     snprintf(buf,len,CONFIG_RTAI_FIFOS_TEMPLATE,minor);
00737     <span class="keywordflow">return</span> buf;
00738 }
00739 
00740 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_getfifobyname,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name))
00741 {
00742         <span class="keywordtype">int</span> fd, minor;
00743         <span class="keywordtype">char</span> nm[RTF_NAMELEN+1];
00744 
00745         <span class="keywordflow">if</span> (strlen(name) &gt; RTF_NAMELEN) {
00746                 <span class="keywordflow">return</span> -1;
00747         }
00748         <span class="keywordflow">if</span> ((fd = open(rtf_getfifobyminor(0,nm,<span class="keyword">sizeof</span>(nm)), O_RDONLY)) &lt; 0) {
00749                 <span class="keywordflow">return</span> -errno;
00750         }
00751         strncpy(nm, name, RTF_NAMELEN+1);
00752         minor = ioctl(fd, RTF_NAME_LOOKUP, nm);
00753         close(fd);
00754         <span class="keywordflow">return</span> minor &lt; 0 ? -errno : minor;
00755 }
00756 
00757 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_named_create,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> size))
00758 {
00759         <span class="keywordtype">int</span> fd, minor;
00760         <span class="keywordtype">char</span> nm[RTF_NAMELEN+1];
00761 
00762         <span class="keywordflow">if</span> (strlen(name) &gt; RTF_NAMELEN) {
00763                 <span class="keywordflow">return</span> -1;
00764         }
00765         <span class="keywordflow">if</span> ((fd = open(rtf_getfifobyminor(0,nm,<span class="keyword">sizeof</span>(nm)), O_RDONLY)) &lt; 0) {
00766                 <span class="keywordflow">return</span> -errno;
00767         }
00768         strncpy(nm, name, RTF_NAMELEN+1);
00769         minor = ioctl(fd, RTF_NAMED_CREATE, nm, size);
00770         close(fd);
00771         <span class="keywordflow">return</span> minor &lt; 0 ? -errno : minor;
00772 }
00773 
00774 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_create_named,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name))
00775 {
00776         <span class="keywordtype">int</span> fd, minor;
00777         <span class="keywordtype">char</span> nm[RTF_NAMELEN+1];
00778 
00779         <span class="keywordflow">if</span> (strlen(name) &gt; RTF_NAMELEN) {
00780                 <span class="keywordflow">return</span> -1;
00781         }
00782         <span class="keywordflow">if</span> ((fd = open(rtf_getfifobyminor(0,nm,<span class="keyword">sizeof</span>(nm)), O_RDONLY)) &lt; 0) { 
00783                 <span class="keywordflow">return</span> -errno;
00784         }
00785         strncpy(nm, name, RTF_NAMELEN+1);
00786         minor = ioctl(fd, RTF_CREATE_NAMED, nm);
00787         close(fd);
00788         <span class="keywordflow">return</span> minor &lt; 0 ? -errno : minor;
00789 }
00790 
00791 <span class="preprocessor">#ifdef __cplusplus</span>
00792 <span class="preprocessor"></span>}
00793 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00794 
00795 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00796 
00797 <span class="preprocessor">#endif </span><span class="comment">/* !_RTAI_FIFOS_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Jul 24 19:31:25 2004 for RTAI API by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
