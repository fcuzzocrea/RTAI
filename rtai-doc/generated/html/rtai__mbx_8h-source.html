<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTAI API: rtai-core/include/rtai_mbx.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>rtai-core/include/rtai_mbx.h</h1><a href="rtai__mbx_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00024 <span class="preprocessor">#ifndef _RTAI_MBX_H</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define _RTAI_MBX_H</span>
00026 <span class="preprocessor"></span>
00027 <span class="preprocessor">#include &lt;<a class="code" href="rtai__sem_8h.html">rtai_sem.h</a>&gt;</span>
00028 
00029 <span class="keyword">struct </span>rt_task_struct;
00030 <span class="keyword">struct </span>rt_mailbox;
00031 
00032 <span class="preprocessor">#ifdef __KERNEL__</span>
00033 <span class="preprocessor"></span>
00034 <span class="preprocessor">#ifdef CONFIG_RTAI_MBX_BUILTIN</span>
00035 <span class="preprocessor"></span><span class="preprocessor">#define MBX_INIT_MODULE     mbx_init_module</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define MBX_CLEANUP_MODULE  mbx_cleanup_module</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#else  </span><span class="comment">/* !CONFIG_RTAI_MBX_BUILTIN */</span>
00038 <span class="preprocessor">#define MBX_INIT_MODULE     init_module</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define MBX_CLEANUP_MODULE  cleanup_module</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* CONFIG_RTAI_MBX_BUILTIN */</span>
00041 
00042 <span class="preprocessor">#ifndef __cplusplus</span>
00043 <span class="preprocessor"></span>
00044 <span class="keyword">typedef</span> <span class="keyword">struct </span>rt_mailbox {
00045 
00046     <span class="keywordtype">int</span> magic;
00047     SEM sndsem, rcvsem;
00048     <span class="keyword">struct </span>rt_task_struct *waiting_task, *owndby;
00049     <span class="keywordtype">char</span> *bufadr;
00050     <span class="keywordtype">int</span> size, fbyte, lbyte, avbs, frbs;
00051     spinlock_t lock;
00052 
00053 } MBX;
00054 
00055 <span class="preprocessor">#else </span><span class="comment">/* __cplusplus */</span>
00056 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00057 <span class="preprocessor">#endif </span><span class="comment">/* !__cplusplus */</span>
00058 
00059 <span class="keywordtype">int</span> MBX_INIT_MODULE(<span class="keywordtype">void</span>);
00060 
00061 <span class="keywordtype">void</span> MBX_CLEANUP_MODULE(<span class="keywordtype">void</span>);
00062 
00063 <span class="keywordtype">int</span> rt_typed_mbx_init(<span class="keyword">struct</span> rt_mailbox *mbx,
00064                       <span class="keywordtype">int</span> size,
00065                       <span class="keywordtype">int</span> qtype);
00066 
00067 <span class="keywordtype">int</span> <a class="code" href="group__lxrt.html#a348">rt_mbx_init</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00068                 <span class="keywordtype">int</span> size);
00069 
00070 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a12">rt_mbx_delete</a>(<span class="keyword">struct</span> rt_mailbox *mbx);
00071 
00072 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a13">rt_mbx_send</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00073                 <span class="keywordtype">void</span> *msg,
00074                 <span class="keywordtype">int</span> msg_size);
00075 
00076 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a14">rt_mbx_send_wp</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00077                    <span class="keywordtype">void</span> *msg,
00078                    <span class="keywordtype">int</span> msg_size);
00079 
00080 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a15">rt_mbx_send_if</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00081                    <span class="keywordtype">void</span> *msg,
00082                    <span class="keywordtype">int</span> msg_size);
00083 
00084 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a16">rt_mbx_send_until</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00085                       <span class="keywordtype">void</span> *msg,
00086                       <span class="keywordtype">int</span> msg_size,
00087                       RTIME time);
00088 
00089 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a17">rt_mbx_send_timed</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00090                       <span class="keywordtype">void</span> *msg,
00091                       <span class="keywordtype">int</span> msg_size,
00092                       RTIME delay);
00093 
00094 <span class="keywordtype">int</span> rt_mbx_ovrwr_send(<span class="keyword">struct</span> rt_mailbox *mbx,
00095                       <span class="keywordtype">void</span> *msg,
00096                       <span class="keywordtype">int</span> msg_size);
00097 
00098 <span class="keywordtype">int</span> rt_mbx_evdrp(<span class="keyword">struct</span> rt_mailbox *mbx,
00099                  <span class="keywordtype">void</span> *msg,
00100                  <span class="keywordtype">int</span> msg_size);
00101 
00102 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a18">rt_mbx_receive</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00103                    <span class="keywordtype">void</span> *msg,
00104                    <span class="keywordtype">int</span> msg_size);
00105 
00106 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a19">rt_mbx_receive_wp</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00107                       <span class="keywordtype">void</span> *msg,
00108                       <span class="keywordtype">int</span> msg_size);
00109 
00110 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a20">rt_mbx_receive_if</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00111                       <span class="keywordtype">void</span> *msg,
00112                       <span class="keywordtype">int</span> msg_size);
00113 
00114 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a21">rt_mbx_receive_until</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00115                          <span class="keywordtype">void</span> *msg,
00116                          <span class="keywordtype">int</span> msg_size,
00117                          RTIME time);
00118 
00119 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a22">rt_mbx_receive_timed</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00120                          <span class="keywordtype">void</span> *msg,
00121                          <span class="keywordtype">int</span> msg_size,
00122                          RTIME delay);
00123 
00124 <span class="keyword">struct </span>rt_mailbox *_rt_typed_named_mbx_init(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> mbx_name,
00125                                            <span class="keywordtype">int</span> size,
00126                                            <span class="keywordtype">int</span> qtype);
00127 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span>rt_mailbox *rt_typed_named_mbx_init(<span class="keyword">const</span> <span class="keywordtype">char</span> *mbx_name, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span> qtype)
00128 {
00129         <span class="keywordflow">return</span> _rt_typed_named_mbx_init(<a class="code" href="rtai__nam2num_8h.html#a0">nam2num</a>(mbx_name), size, qtype);
00130 }
00131 
00132 <span class="keywordtype">int</span> rt_named_mbx_delete(<span class="keyword">struct</span> rt_mailbox *mbx);
00133 
00134 <span class="preprocessor">#define rt_named_mbx_init(mbx_name, size)  rt_typed_named_mbx_init(mbx_name, size, FIFO_Q)</span>
00135 <span class="preprocessor"></span>
00136 <span class="preprocessor">#ifdef __cplusplus</span>
00137 <span class="preprocessor"></span>}
00138 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00139 
00140 <span class="preprocessor">#else </span><span class="comment">/* !__KERNEL__ */</span>
00141 
00142 <span class="preprocessor">#include &lt;<a class="code" href="rtai__lxrt_8h.html">rtai_lxrt.h</a>&gt;</span>
00143 
00144 <span class="preprocessor">#ifdef __cplusplus</span>
00145 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00146 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00147 
00148 RTAI_PROTO(<span class="keywordtype">void</span> *,rt_typed_mbx_init,(<span class="keywordtype">int</span> name, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span> qtype))
00149 {
00150         <span class="keyword">struct </span>{ <span class="keywordtype">int</span> name; <span class="keywordtype">int</span> size; <span class="keywordtype">int</span> qtype; } arg = { name, size, qtype };
00151         <span class="keywordflow">return</span> rtai_lxrt(BIDX, SIZARG, LXRT_MBX_INIT, &amp;arg).v[LOW];
00152 }
00153 
<a name="l00168"></a><a class="code" href="group__lxrt.html#a348">00168</a> <span class="preprocessor">#define rt_mbx_init(name, size) rt_typed_mbx_init(name, size, FIFO_Q)</span>
00169 <span class="preprocessor"></span>
00170 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_delete,(<span class="keyword">struct</span> rt_mailbox *mbx))
00171 {
00172         <span class="keywordtype">void</span> *arg = mbx;
00173         <span class="keywordflow">return</span> rtai_lxrt(BIDX, SIZARG, LXRT_MBX_DELETE, &amp;arg).i[LOW];
00174 }
00175 
00176 RTAI_PROTO(<span class="keyword">struct</span> rt_mailbox *, rt_typed_named_mbx_init,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span> type))
00177 {
00178         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> name; <span class="keywordtype">int</span> size, type; } arg = { <a class="code" href="rtai__nam2num_8h.html#a0">nam2num</a>(name), size, type };
00179         <span class="keywordflow">return</span> (<span class="keyword">struct </span>rt_mailbox *)rtai_lxrt(BIDX, SIZARG, NAMED_MBX_INIT, &amp;arg).v[LOW];
00180 }
00181 
00182 RTAI_PROTO(<span class="keywordtype">int</span>, rt_named_mbx_delete,(<span class="keyword">struct</span> rt_mailbox *mbx))
00183 {
00184         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; } arg = { mbx };
00185         <span class="keywordflow">return</span> rtai_lxrt(BIDX, SIZARG, NAMED_MBX_DELETE, &amp;arg).i[LOW];
00186 }
00187 
00188 <span class="preprocessor">#define rt_named_mbx_init(mbx_name, size) \</span>
00189 <span class="preprocessor">        rt_typed_named_mbx_init(mbx_name, size, FIFO_Q)</span>
00190 <span class="preprocessor"></span>
00191 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_send,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00192 {
00193         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00194         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_SEND, &amp;arg).i[LOW];
00195 }
00196 
00197 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_send_wp,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00198 {
00199         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00200         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_SEND_WP, &amp;arg).i[LOW];
00201 }
00202 
00203 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_send_if,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00204 {
00205         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00206         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_SEND_IF, &amp;arg).i[LOW];
00207 }
00208 
00209 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_send_until,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size, RTIME time))
00210 {
00211         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; RTIME time; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size, time };
00212         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_SEND_UNTIL, &amp;arg).i[LOW];
00213 }
00214 
00215 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_send_timed,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size, RTIME delay))
00216 {
00217         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; RTIME delay; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size, delay };
00218         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_SEND_TIMED, &amp;arg).i[LOW];
00219 }
00220 
00221 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_ovrwr_send,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00222 {
00223         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00224         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_OVRWR_SEND, &amp;arg).i[LOW];
00225 }
00226 
00227 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_evdrp,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00228 {
00229         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00230         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_EVDRP, &amp;arg).i[LOW];
00231 }
00232 
00233 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_receive,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00234 {
00235         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00236         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_RECEIVE, &amp;arg).i[LOW];
00237 }
00238 
00239 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_receive_wp,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00240 {
00241         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00242         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_RECEIVE_WP, &amp;arg).i[LOW];
00243 }
00244 
00245 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_receive_if,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00246 {
00247         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00248         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_RECEIVE_IF, &amp;arg).i[LOW];
00249 }
00250 
00251 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_receive_until,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size, RTIME time))
00252 {
00253         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">void</span> *msg; <span class="keywordtype">int</span> msg_size; RTIME time; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size, time };
00254         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_RECEIVE_UNTIL, &amp;arg).i[LOW];
00255 }
00256 
00257 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_receive_timed,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size, RTIME delay))
00258 {
00259         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; RTIME delay; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size, delay };
00260         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_RECEIVE_TIMED, &amp;arg).i[LOW];
00261 }
00262 
00263 <span class="preprocessor">#ifdef __cplusplus</span>
00264 <span class="preprocessor"></span>}
00265 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00266 
00267 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00268 
00269 <span class="preprocessor">#if !defined(__KERNEL__) || defined(__cplusplus)</span>
00270 <span class="preprocessor"></span>
00271 <span class="keyword">typedef</span> <span class="keyword">struct </span>rt_mailbox {
00272     <span class="keywordtype">int</span> opaque;
00273 } MBX;
00274 
00275 <span class="preprocessor">#endif </span><span class="comment">/* !__KERNEL__ || __cplusplus */</span>
00276 
00277 <span class="preprocessor">#endif </span><span class="comment">/* !_RTAI_MBX_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Jun 20 20:09:32 2004 for RTAI API by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
