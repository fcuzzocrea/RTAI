<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTAI API: rtai-core/include/asm-i386/rtai_oldnames.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>rtai-core/include/asm-i386/rtai_oldnames.h</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> *   ARTI -- RTAI-compatible Adeos-based Real-Time Interface. Based on</span>
00003 <span class="comment"> *   the original RTAI layer for x86. This file provides user-visible</span>
00004 <span class="comment"> *   definitions for compatibility purpose with the legacy RTHAL. Must</span>
00005 <span class="comment"> *   be included from rtai_hal.h only.</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> *   Original RTAI/x86 layer implementation:</span>
00008 <span class="comment"> *   Copyright (C) 2000 Paolo Mantegazza,</span>
00009 <span class="comment"> *   Copyright (C) 2000 Steve Papacharalambous,</span>
00010 <span class="comment"> *   Copyright (C) 2000 Stuart Hughes,</span>
00011 <span class="comment"> *   and others.</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *   RTAI/x86 rewrite over Adeos:</span>
00014 <span class="comment"> *   Copyright (C) 2002 Philippe Gerum.</span>
00015 <span class="comment"> *</span>
00016 <span class="comment"> *   This program is free software; you can redistribute it and/or modify</span>
00017 <span class="comment"> *   it under the terms of the GNU General Public License as published by</span>
00018 <span class="comment"> *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,</span>
00019 <span class="comment"> *   USA; either version 2 of the License, or (at your option) any later</span>
00020 <span class="comment"> *   version.</span>
00021 <span class="comment"> *</span>
00022 <span class="comment"> *   This program is distributed in the hope that it will be useful,</span>
00023 <span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00024 <span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00025 <span class="comment"> *   GNU General Public License for more details.</span>
00026 <span class="comment"> *</span>
00027 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00028 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00029 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00030 <span class="comment"> */</span>
00031 
00032 <span class="preprocessor">#ifndef _RTAI_ASM_I386_OLDNAMES_H</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#define _RTAI_ASM_I386_OLDNAMES_H</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#ifdef __KERNEL__</span>
00036 <span class="preprocessor"></span>
00037 <span class="preprocessor">#define IFLAG                        ARTI_IFLAG</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define hard_cli()                   arti_cli()</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define hard_sti()                   arti_sti()</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define hard_save_flags_and_cli(x)   arti_local_irq_save(x)</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define hard_restore_flags(x)        arti_local_irq_restore(x)</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define hard_save_flags(x)           arti_local_irq_flags(x)</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#define hard_cpu_id                  adeos_processor_id</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define this_rt_task                 ptd</span>
00045 <span class="preprocessor"></span>
00046 <span class="keyword">struct </span>rt_hal {
00047     <span class="keywordtype">void</span> *ret_from_intr;
00048     <span class="keywordtype">void</span> *__switch_to;
00049     <span class="keywordtype">void</span> *padding_0;
00050     void (*disint)(<span class="keywordtype">void</span>);
00051     void (*enint)(<span class="keywordtype">void</span>);
00052     unsigned (*getflags)(<span class="keywordtype">void</span>);
00053     void (*setflags)(<span class="keywordtype">unsigned</span> flags); 
00054     unsigned (*getflags_and_cli)(<span class="keywordtype">void</span>);
00055     <span class="keywordtype">void</span> *padding_1;
00056     <span class="keywordtype">void</span> *padding_2;
00057     <span class="keywordtype">void</span> *padding_3;
00058     <span class="keywordtype">void</span> *padding_4;
00059     <span class="keywordtype">void</span> *padding_5;
00060     <span class="keywordtype">void</span> *padding_6;
00061     void (*lxrt_global_cli)(<span class="keywordtype">void</span>);
00062     void (*switch_mem)(<span class="keyword">struct </span>task_struct *, <span class="keyword">struct </span>task_struct *, <span class="keywordtype">int</span>);
00063     <span class="keywordtype">void</span> *padding_7;
00064     <span class="keyword">volatile</span> <span class="keywordtype">int</span> *apicmap;
00065 }; <span class="comment">/* A partial HAL struct for source compatibility purpose. */</span>
00066 
00067 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00068 
00069 <span class="preprocessor">#ifdef __ARTI__</span>
00070 <span class="preprocessor"></span>
00071 <span class="keyword">static</span> <span class="keywordtype">void</span> arti_compat_hard_cli(<span class="keywordtype">void</span>) {
00072     arti_cli();
00073 }
00074 
00075 <span class="keyword">static</span> void (*rtai_exit_callback)(<span class="keywordtype">void</span>);
00076 
00077 <span class="keywordtype">void</span> arti_compat_exit_trampoline (adevinfo_t *evinfo) {
00078 
00079 <span class="comment">/* FIXME? Adeos only provides for a single process exit callback</span>
00080 <span class="comment">through adeos_catch_event(). If we need more than one routine to be</span>
00081 <span class="comment">registered here, we will have to provide a linked list by</span>
00082 <span class="comment">ourselves. */</span>
00083 
00084     <span class="keyword">struct </span>task_struct *task = (<span class="keyword">struct </span>task_struct *)evinfo-&gt;evdata;
00085 
00086     <span class="keywordflow">if</span> (task-&gt;ptd[0])
00087         rtai_exit_callback();
00088 
00089     adeos_propagate_event(evinfo);
00090 }
00091 
00092 <span class="keywordtype">int</span> set_rtai_callback (<span class="keywordtype">void</span> (*fun)(<span class="keywordtype">void</span>)) {
00093     rtai_exit_callback = fun;
00094     <span class="keywordflow">return</span> adeos_catch_event(ADEOS_EXIT_PROCESS,&amp;arti_compat_exit_trampoline);
00095 }
00096 
00097 <span class="keywordtype">void</span> remove_rtai_callback (<span class="keywordtype">void</span> (*fun)(<span class="keywordtype">void</span>)) {
00098     adeos_catch_event(ADEOS_EXIT_PROCESS,0);
00099 }
00100 
00101 <span class="keyword">extern</span> <span class="keywordtype">void</span> *ret_from_intr;
00102 
00103 <span class="keyword">struct </span>rt_hal rthal = {
00104     &amp;ret_from_intr,
00105     &amp;__switch_to,
00106     0,
00107     &amp;arti_linux_cli,
00108     &amp;arti_linux_sti,
00109     &amp;arti_linux_save_flags,
00110     &amp;arti_linux_restore_flags,
00111     &amp;arti_linux_save_flags_and_cli,
00112     0,
00113     0,
00114     0,
00115     0,
00116     0,
00117     0,
00118     &amp;arti_compat_hard_cli,
00119     &amp;arti_switch_linux_mm,
00120     0,
00121 <span class="preprocessor">#ifdef CONFIG_SMP</span>
00122 <span class="preprocessor"></span><span class="preprocessor">#ifdef CONFIG_MULTIQUAD</span>
00123 <span class="preprocessor"></span>    logical_apicid_2_cpu,
00124 <span class="preprocessor">#else  </span><span class="comment">/* !CONFIG_MULTIQUAD */</span>
00125     physical_apicid_2_cpu,
00126 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_MULTIQUAD */</span>
00127 <span class="preprocessor">#else </span><span class="comment">/* !CONFIG_SMP */</span>
00128     0,
00129 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_SMP */</span>
00130 }; <span class="comment">/* A partial HAL struct for source compatibility purpose. */</span>
00131 
00132 <span class="preprocessor">#else </span><span class="comment">/* !__ARTI__ */</span>
00133 
00134 <span class="preprocessor">#define tuned           arti_tunables</span>
00135 <span class="preprocessor"></span><span class="preprocessor">#define NR_RT_CPUS      ARTI_NR_CPUS</span>
00136 <span class="preprocessor"></span><span class="preprocessor">#define RT_TIME_END     ARTI_TIME_LIMIT</span>
00137 <span class="preprocessor"></span>
00138 <span class="preprocessor">#define CPU_FREQ        ARTI_CPU_FREQ</span>
00139 <span class="preprocessor"></span><span class="preprocessor">#define TIMER_8254_IRQ  ARTI_TIMER_8254_IRQ</span>
00140 <span class="preprocessor"></span><span class="preprocessor">#define FREQ_8254       ARTI_FREQ_8254</span>
00141 <span class="preprocessor"></span><span class="preprocessor">#define LATENCY_8254    ARTI_LATENCY_8254</span>
00142 <span class="preprocessor"></span><span class="preprocessor">#define SETUP_TIME_8254 ARTI_SETUP_TIME_8254</span>
00143 <span class="preprocessor"></span>
00144 <span class="preprocessor">#define FREQ_APIC       ARTI_FREQ_APIC</span>
00145 <span class="preprocessor"></span><span class="preprocessor">#define LATENCY_APIC    ARTI_LATENCY_APIC</span>
00146 <span class="preprocessor"></span><span class="preprocessor">#define SETUP_TIME_APIC ARTI_SETUP_TIME_APIC</span>
00147 <span class="preprocessor"></span>
00148 <span class="preprocessor">#define CALIBRATED_APIC_FREQ  ARTI_CALIBRATED_APIC_FREQ</span>
00149 <span class="preprocessor"></span><span class="preprocessor">#define CALIBRATED_CPU_FREQ   ARTI_CALIBRATED_CPU_FREQ</span>
00150 <span class="preprocessor"></span>
00151 <span class="preprocessor">#ifdef __KERNEL__</span>
00152 <span class="preprocessor"></span>
00153 <span class="comment">/* For compatibility reasons with RTHAL, IPIs numbers are indices into</span>
00154 <span class="comment">   the __ipi2vec[] array, instead of actual interrupt numbers. */</span>
00155 
00156 <span class="preprocessor">#define RTAI_1_VECTOR  RTAI_APIC1_VECTOR</span>
00157 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_1_IPI     6</span>
00158 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_2_VECTOR  RTAI_APIC2_VECTOR</span>
00159 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_2_IPI     7</span>
00160 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_3_VECTOR  RTAI_APIC3_VECTOR</span>
00161 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_3_IPI     8</span>
00162 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_4_VECTOR  RTAI_APIC4_VECTOR</span>
00163 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_4_IPI     9</span>
00164 <span class="preprocessor"></span>
00165 <span class="preprocessor">#define broadcast_to_local_timers arti_broadcast_to_timers</span>
00166 <span class="preprocessor"></span><span class="preprocessor">#define rtai_signal_handler       arti_signal_handler</span>
00167 <span class="preprocessor"></span><span class="preprocessor">#define rt_set_rtai_trap_handler  rt_set_trap_handler</span>
00168 <span class="preprocessor"></span><span class="preprocessor">#define rt_mount_rtai             rt_mount</span>
00169 <span class="preprocessor"></span><span class="preprocessor">#define rt_umount_rtai            rt_umount</span>
00170 <span class="preprocessor"></span><span class="preprocessor">#define calibrate_8254            arti_calibrate_8254</span>
00171 <span class="preprocessor"></span>
00172 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_request_global_irq_ext(<span class="keywordtype">unsigned</span> irq,
00173                                             <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>),
00174                                             <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cookie) {
00175 
00176     <span class="keywordflow">return</span> rt_request_irq(irq,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">unsigned</span>,<span class="keywordtype">void</span> *))handler,(<span class="keywordtype">void</span> *)cookie);
00177 }
00178 
00179 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__hal.html#a94">rt_request_global_irq</a>(<span class="keywordtype">unsigned</span> irq,
00180                                         <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>)) {
00181 
00182     <span class="keywordflow">return</span> rt_request_irq(irq,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">unsigned</span>,<span class="keywordtype">void</span> *))handler,0);
00183 }
00184 
00185 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> rt_set_global_irq_ext(<span class="keywordtype">unsigned</span> irq,
00186                                          <span class="keywordtype">int</span> ext,
00187                                          <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cookie) {
00188 
00189     rt_set_irq_cookie(irq,(<span class="keywordtype">void</span> *)cookie);
00190 }
00191 
00192 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__hal.html#a95">rt_free_global_irq</a>(<span class="keywordtype">unsigned</span> irq) {
00193 
00194     <span class="keywordflow">return</span> rt_release_irq(irq);
00195 }
00196 
00197 <span class="preprocessor">#undef  rdtsc</span>
00198 <span class="preprocessor"></span><span class="preprocessor">#define rdtsc()     arti_rdtsc()</span>
00199 <span class="preprocessor"></span><span class="preprocessor">#define rd_CPU_ts() rdtsc()</span>
00200 <span class="preprocessor"></span>
00201 <span class="preprocessor">#define ulldiv(a,b,c)  arti_ulldiv(a,b,c)</span>
00202 <span class="preprocessor"></span><span class="preprocessor">#define imuldiv(a,b,c) arti_imuldiv(a,b,c)</span>
00203 <span class="preprocessor"></span><span class="preprocessor">#define llimd(a,b,c)   arti_llimd(a,b,c)</span>
00204 <span class="preprocessor"></span>
00205 <span class="preprocessor">#define locked_cpus                        (&amp;arti_cpu_lock)</span>
00206 <span class="preprocessor"></span>
00207 <span class="preprocessor">#define lxrt_hrt_flags        arti_cpu_lxrt</span>
00208 <span class="preprocessor"></span><span class="preprocessor">#define rtai_print_to_screen  rt_printk</span>
00209 <span class="preprocessor"></span>
00210 <span class="preprocessor">#define RTAI_NR_TRAPS         ADEOS_NR_FAULTS</span>
00211 <span class="preprocessor"></span>
00212 <span class="preprocessor">#ifdef ARTI_EMULATE_TSC</span>
00213 <span class="preprocessor"></span>
00214 <span class="preprocessor">#define DECLR_8254_TSC_EMULATION \</span>
00215 <span class="preprocessor">extern void *kd_mksound; \</span>
00216 <span class="preprocessor">static void *linux_mksound; \</span>
00217 <span class="preprocessor">static void rtai_mksound(void) { }</span>
00218 <span class="preprocessor"></span>
00219 <span class="preprocessor">#define TICK_8254_TSC_EMULATION  rdtsc()</span>
00220 <span class="preprocessor"></span>
00221 <span class="preprocessor">#define SETUP_8254_TSC_EMULATION \</span>
00222 <span class="preprocessor">        do { \</span>
00223 <span class="preprocessor">                linux_mksound = kd_mksound; \</span>
00224 <span class="preprocessor">                kd_mksound = rtai_mksound; \</span>
00225 <span class="preprocessor">                rt_setup_8254_tsc(); \</span>
00226 <span class="preprocessor">        } while (0)</span>
00227 <span class="preprocessor"></span>
00228 <span class="preprocessor">#define CLEAR_8254_TSC_EMULATION \</span>
00229 <span class="preprocessor">        do { \</span>
00230 <span class="preprocessor">                if (linux_mksound) { \</span>
00231 <span class="preprocessor">                        kd_mksound = linux_mksound; \</span>
00232 <span class="preprocessor">                } \</span>
00233 <span class="preprocessor">        } while (0)</span>
00234 <span class="preprocessor"></span>
00235 <span class="preprocessor">#else </span><span class="comment">/* ARTI_EMULATE_TSC */</span>
00236 
00237 <span class="preprocessor">#define DECLR_8254_TSC_EMULATION</span>
00238 <span class="preprocessor"></span><span class="preprocessor">#define TICK_8254_TSC_EMULATION</span>
00239 <span class="preprocessor"></span><span class="preprocessor">#define SETUP_8254_TSC_EMULATION</span>
00240 <span class="preprocessor"></span><span class="preprocessor">#define CLEAR_8254_TSC_EMULATION</span>
00241 <span class="preprocessor"></span>
00242 <span class="preprocessor">#endif </span><span class="comment">/* !ARTI_EMULATE_TSC */</span>
00243 
00244 <span class="preprocessor">#ifndef __cplusplus</span>
00245 <span class="preprocessor"></span>
00246 <span class="preprocessor">#include &lt;linux/irq.h&gt;</span>
00247 <span class="preprocessor">#include &lt;asm/desc.h&gt;</span>
00248 
00249 <span class="keyword">extern</span> <span class="keyword">struct </span>desc_struct idt_table[];
00250 
00251 <span class="keyword">extern</span> <span class="keyword">struct </span>rt_hal rthal;
00252 
00253 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span>desc_struct rt_set_full_intr_vect (unsigned vector,
00254                                                         int type,
00255                                                         int dpl,
00256                                                         void (*handler)(<span class="keywordtype">void</span>)) {
00257     <span class="keyword">struct </span>desc_struct e = idt_table[vector];
00258     idt_table[vector].a = (__KERNEL_CS &lt;&lt; 16) | ((<span class="keywordtype">unsigned</span>)handler &amp; 0x0000FFFF);
00259     idt_table[vector].b = ((<span class="keywordtype">unsigned</span>)handler &amp; 0xFFFF0000) | (0x8000 + (dpl &lt;&lt; 13) + (type &lt;&lt; 8));
00260     <span class="keywordflow">return</span> e;
00261 }
00262 
00263 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> rt_reset_full_intr_vect(<span class="keywordtype">unsigned</span> vector,
00264                                            <span class="keyword">struct</span> desc_struct e) {
00265     idt_table[vector] = e;
00266 }
00267 
00268 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> __ipi2vec[] = {
00269     INVALIDATE_TLB_VECTOR,
00270     LOCAL_TIMER_VECTOR,
00271     RESCHEDULE_VECTOR,
00272     CALL_FUNCTION_VECTOR,
00273     SPURIOUS_APIC_VECTOR,
00274     ERROR_APIC_VECTOR,
00275     -1,                 <span class="comment">/* RTAI_1_VECTOR: reserved */</span>
00276     -1,                 <span class="comment">/* RTAI_2_VECTOR: reserved */</span>
00277     RTAI_3_VECTOR,
00278     RTAI_4_VECTOR
00279 };
00280 
00281 <span class="preprocessor">#define __vec2irq(v) ((v) - FIRST_EXTERNAL_VECTOR)</span>
00282 <span class="preprocessor"></span>
00283 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> __ipi2irq[] = {
00284     __vec2irq(INVALIDATE_TLB_VECTOR),
00285     __vec2irq(LOCAL_TIMER_VECTOR),
00286     __vec2irq(RESCHEDULE_VECTOR),
00287     __vec2irq(CALL_FUNCTION_VECTOR),
00288     __vec2irq(SPURIOUS_APIC_VECTOR),
00289     __vec2irq(ERROR_APIC_VECTOR),
00290     (<span class="keywordtype">unsigned</span>)-1,       <span class="comment">/* RTAI_1_IPI: reserved */</span>
00291     (<span class="keywordtype">unsigned</span>)-1,       <span class="comment">/* RTAI_2_IPI: reserved */</span>
00292     RTAI_APIC3_IPI,
00293     RTAI_APIC4_IPI
00294 };
00295 
00296 <span class="comment">/* cpu_own_irq() routines are RTHAL-specific and emulated here for</span>
00297 <span class="comment">   compatibility purposes. */</span>
00298 
00299 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_request_cpu_own_irq (<span class="keywordtype">unsigned</span> ipi, <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>)) {
00300 
00301     <span class="keywordflow">return</span> ipi &lt; 10 ? rt_request_irq(__ipi2irq[ipi],(rt_irq_handler_t)handler,0) : -EINVAL;
00302 }
00303 
00304 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_free_cpu_own_irq (<span class="keywordtype">unsigned</span> ipi) {
00305 
00306     <span class="keywordflow">return</span> ipi &lt; 10 ? rt_release_irq(__ipi2irq[ipi]) : -EINVAL;
00307 }
00308 
00309 <span class="preprocessor">#ifdef CONFIG_SMP</span>
00310 <span class="preprocessor"></span>
00311 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> send_ipi_shorthand (<span class="keywordtype">unsigned</span> shorthand,
00312                                        <span class="keywordtype">int</span> irq) {
00313     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags;
00314     arti_hw_lock(flags);
00315     apic_wait_icr_idle();
00316     apic_write_around(APIC_ICR,APIC_DEST_LOGICAL|shorthand|__ipi2vec[irq]);
00317     arti_hw_unlock(flags);
00318 }
00319 
00320 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> send_ipi_logical (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> dest,
00321                                      <span class="keywordtype">int</span> irq) {
00322     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags;
00323 
00324     <span class="keywordflow">if</span> ((dest &amp;= cpu_online_map) != 0)
00325         {
00326         arti_hw_lock(flags);
00327         apic_wait_icr_idle();
00328         apic_write_around(APIC_ICR2,SET_APIC_DEST_FIELD(dest));
00329         apic_write_around(APIC_ICR,APIC_DEST_LOGICAL|__ipi2vec[irq]);
00330         arti_hw_unlock(flags);
00331         }
00332 }
00333 
00334 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_SMP */</span>
00335 
00336 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> *get_intr_handler (<span class="keywordtype">unsigned</span> vector) {
00337 
00338     <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)((idt_table[vector].b &amp; 0xFFFF0000) | 
00339                     (idt_table[vector].a &amp; 0x0000FFFF));
00340 }
00341 
00342 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> set_intr_vect (<span class="keywordtype">unsigned</span> vector,
00343                                   <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>)) {
00344 
00345     idt_table[vector].a = (idt_table[vector].a &amp; 0xFFFF0000) | 
00346         ((<span class="keywordtype">unsigned</span>)handler &amp; 0x0000FFFF);
00347     idt_table[vector].b = ((<span class="keywordtype">unsigned</span>)handler &amp; 0xFFFF0000) | 
00348         (idt_table[vector].b &amp; 0x0000FFFF);
00349 }
00350 
00351 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> *rt_set_intr_handler (<span class="keywordtype">unsigned</span> vector,
00352                                          <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>)) {
00353 
00354     void (*saved_handler)(<span class="keywordtype">void</span>) = get_intr_handler(vector);
00355     set_intr_vect(vector, handler);
00356     <span class="keywordflow">return</span> saved_handler;
00357 }
00358 
00359 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> rt_reset_intr_handler (<span class="keywordtype">unsigned</span> vector,
00360                                           <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>)) {
00361     set_intr_vect(vector, handler);
00362 }
00363 
00364 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> get_cr2 (<span class="keywordtype">void</span>) {
00365 
00366     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> address;
00367     __asm__(<span class="stringliteral">"movl %%cr2,%0"</span>:<span class="stringliteral">"=r"</span> (address));
00368     <span class="keywordflow">return</span> address;
00369 }
00370 
00371 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00372 
00373 <span class="preprocessor">#endif </span><span class="comment">/* !__cplusplus */</span>
00374 
00375 <span class="preprocessor">#endif </span><span class="comment">/* __ARTI__ */</span>
00376 
00377 <span class="preprocessor">#endif </span><span class="comment">/* !_RTAI_ASM_I386_OLDNAMES_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Jul 24 19:31:25 2004 for RTAI API by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
